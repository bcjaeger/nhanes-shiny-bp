---
title: "Cardiometabolic statistics for US adults: an open source web application for exploratory analysis"
always_allow_html: true
output: 
  officedown::rdocx_document:
    reference_docx: style_manuscript_times_new_roman.docx
    keep_md: true
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
 echo = FALSE,
 message = FALSE,
 warning = FALSE,
 fig.width = 10.5,
 fig.height = 4, 
 dpi = 300
)

suppressPackageStartupMessages({
 library(officer)
 library(cardioStatsUSA)
 library(magrittr)
 library(gtsummary)
 library(tidyverse)
 library(survey)
 library(flextable)
 library(plotly)
})

conflicted::conflict_prefer('as_flextable', 'flextable')
conflicted::conflict_prefer('filter', 'dplyr')
conflicted::conflict_prefer('layout', 'plotly')


# default is double space 
# single spacing for title page, abstract, captions
single_par <- fp_par(line_spacing=1)


abbrvs <- list(
  "CI"   = 'confidence interval',
  "BP"   = "blood pressure",
  "SBP"  = "systolic blood pressure",
  "DBP"  = "diastolic blood pressure",
  "SD"   = 'standard deviation',
  "IQR"  = 'interquartile range',
  "JNC7" = "Seventh Joint National Committee",
  "ACC"  = "American College of Cardiology",
  "AHA"  = "American Heart Association",
  "CVD"  = 'cardiovascular disease'
)

abbrvs_paste <- function(strings){
  
  front <- 'Abbreviations'
  
  matter <- glue::glue_collapse(strings, sep = '; ', last = '; and ')
  
  paste(front, matter, sep = ': ')
  
}

abbrvs_write <- function(abbr){
  
  sorted <- abbr[sort(names(abbr))]
  
  strings <- map2_chr(names(sorted), sorted, paste, sep = ' = ')
  
  abbrvs_paste(strings)
  
}


```

Byron C. Jaeger, PhD,^1^ 
Ligong Chen, PhD,^2^
Adam P. Bress, PharmD, MS,^3,4^ 
YOUR NAME, DEGREE,^x^
Bharat Poudel, MSPH,^2^
Ashley Christenson, BS,^2^ 
Lisandro D. Colantonio, PhD,^2^
Paul Muntner, PhD,^2^

^1^Department of Biostatistics and Data Science, Wake Forest School of Medicine, Winston-Salem, NC. `r single_par`
^2^Department of Epidemiology, University of Alabama at Birmingham. `r single_par`
^3^Informatics, Decision-Enhancement, and Analytic Sciences (IDEAS) Center, Veterans Affairs, Salt Lake City Health Care System, Salt Lake City, UT. `r single_par`
^4^Department of Population Health Sciences, University of Utah School of Medicine, Salt Lake City, UT. `r single_par`
^x^ YOUR AFFILIATION IF IT ISN'T ALREADY DEFINED ABOVE

\newpage

**ABSTRACT**

<!-- Abstract: Structured with the following headings and no more than 250 words: Background, Objectives, Methods, Results, Conclusions. The abstract should present essential data in 5 paragraphs. Use complete sentences. All data in the abstract also must appear in the manuscript text or tables. -->

**Background**: Data from the National Health and Nutrition Examination Survey (NHANES) program are freely available. However, analysis of these data may be time-intensive and challenging. 

**Objectives**: Develop, validate, and share an open-source web application that allows for interactive, exploratory analysis of NHANES data that can be used and extended upon by others.

**Methods**: We developed the open-source web application using the R programming language and several R packages. We validated the web application by using it to reproduce results from two prior studies and a report from the Centers for Disease Control. To demonstrate the application's capabilities, we estimated characteristics of adults in the US, the prevalence of hypertension, distribution of the number of antihypertensive medication classes being used, prevalence of controlled blood pressure (BP) among those with hypertension, and the prevalence of resistant hypertension.

**Results**: The estimated mean systolic BP for all US adults was 123 mm Hg in 1999-2000, 120 mm Hg in 2009-2010, and 123 mm Hg in 2017-2020. The estimated prevalence of hypertension among US adults was lowest in 2009-2010 (43.3%) and highest in 2017-2020 (46.6%), with the estimated number of US adults with hypertension increasing from 89.8 million in 1999-2000 to 115.3 million in 2017-2020 . The age adjusted mean systolic BP was 140 in 1999-2000, 134 in 2009-2010, and 136 in 2017-2020 among US adults with hypertension. Among US adults who self-reported taking antihypertensive medication, the percentage taking four or more classes of antihypertensive medication increased from 3.5% in 1999-2000 to 7.6% in 2017-2020. The age-adjusted estimated prevalence of BP control among US adults with hypertension was 10.2%, 25.8%, and 23.8% in 1999-2000, 2009-2010, and 2017-2020, respectively. Among US adults with hypertension who self-reported taking antihypertensive medication, the prevalence of resistant hypertension was 13.7% in 1999-2000, 17.7% in 2009-2010, and 16.2% in 2017-2020.

**Conclusions.**: The web application developed in the current analysis may increase the usage of NHANES data for research and policy decision making, ensuring results are valid, transparent, and reproducible.

\newpage

The National Health and Nutrition Examination Survey (NHANES) is a program conducted by the US National Center for Health Statistics (NCHS) of the Centers for Disease Control and Prevention (CDC) and is designed to assess the health and nutritional status of the US population. NHANES data have been used to provide nationally representative estimates for adults living in the United States (US) in multiple studies of cardiometabolic outcomes. For example, NHANES data have been used to estimate the impact of the lower blood pressure (BP) levels used to define hypertension and controlled BP in the 2017 American College of Cardiology/American Heart Association (ACC/AHA) BP guideline versus the Seventh Joint National Committee (JNC7) BP guideline on the proportion and number of US adults with hypertension, recommended antihypertensive medication and with uncontrolled BP.  Additionally, NHANES data have been used to track the proportion of US adults with controlled BP, which were included in a Call-to-Action to Control BP from the US Surgeon General.

NHANES data are publicly available and accessible through the CDC website. However, analyzing NHANES data may be challenging for a number of reasons. In particular, specific statistical techniques are required to account for the multi-stage sampling design of NHANES data and produce nationally representative estimates. Also, each NHANES cycle includes over 50 data files, each of which has detailed informational material. NHANES data collection protocols have changed over time for certain variables, and these differences should be accounted for when harmonizing or pooling data from multiple cycles. Another potential challenge is implementation of recommended standards from the CDC, such as their guidelines for suppression of unreliable results. 

To address the challenges of analyzing NHANES data, we developed an open-source web-based application that allows users to obtain nationally representative summaries of cardiometabolic outcomes for US adults using NHANES data. The goal of the application is to increase the usage of NHANES data for research and policy decision making with a focus on ensuring results are valid, transparent, and reproducible. The application is designed to be extended with the addition of "modules", which we define as a set of variables measured among a sub-population of NHANES participants. In this manuscript, we review the design and development of the application, present nationally representative summaries of outcomes from the "BP and Hypertension module", and describe online tutorials and resources that may help users engage with the application.

**METHODS**

The NHANES program was initiated in the early 1960s and beginning in 1999 has been conducted continuously, in two-year cycles. In each cycle, potential participants were identified using a multi-stage sampling process. The protocols for each cycle were approved by the NCHS Institutional Review Board. Written informed consent was obtained from each participant. 

NHANES data include in-home interviews and study examinations conducted at mobile examination centers. The interview includes questions about demographics, health behaviors, prior diagnoses, medication use, and medical history. During the interview, the labels of medications that participants reported taking in the preceding 30 days were recorded. During the study examination, height and weight were measured, blood samples were used to measure cholesterol, glycated hemoglobin and serum creatinine, and spot urine was used to measure albumin and creatinine and to conduct a pregnancy test. Systolic and diastolic BP (SBP and DBP, respectively) were measured three times. BP was measured using a mercury sphygmomanometer from 1999-2000 through 2015-2016 and using an oscillometric device in 2017-2020. 

*Features of the Open-Source Web-Based Application*

Full summaries of this application's features and associated tutorials are available. Briefly, users can select NHANES cycles to be analyzed. Contiguous cycles can be combined to increase precision. Estimates are weighted to represent the non-institutionalized US population and may incorporate age-adjustment using direct standardization. Count estimates are calibrated to match the estimated total number of US adults. Users may visualize summaries of outcomes in groups (i.e., prevalence of hypertension by sex) with all groups in the same figure or with one figure per group, and may additionally specify subsets to exclude from their analyses. All outputs created with the web application can be downloaded and saved. Following CDC recommendations, unreliable statistical estimates are automatically suppressed. 

*Design of the Open-Source Web-Based Application*

The web application was created using Shiny, an open-source software package that translates code from the R programming language into HTML, CSS, or JavaScript commands that create a website interface. The "cardioStatsUSA" R package provides additional details on the web application's design and comprehensive documentation of its components. 

*The Blood Pressure and Hypertension Module*

We define a module as a subpopulation of NHANES participants paired with a collection of variables. Each variable in the collection has designated roles. For example, hypertension can be an outcome and can also be used to define groups when analyzing another outcome. This module definition is general enough to allow for diverse extensions of the web application, but may not be specific enough to illustrate how the web application works. Therefore, in the current analysis, we define and present results from the "BP and hypertension" module, defined as follows.

**Subpopulation:** Beginning with 107,622 US individuals who participated in NHANES 1999-2000 to 2017- March 2020, we restricted the subpopulation to adults ≥ 18 years of age. This exclusion was applied because statistics for hypertension and BP levels in children and adolescents are markedly different than for adults. We further restricted the subpopulation to participants who completed the in-home interview and study examination, with one or more SBP and DBP measurement, and who had data on self-reported antihypertensive medication use. After these exclusions were applied, the sub-population included data from 56,035 participants (Figure S1).

**Variables** The primary variables from the BP and hypertension module are listed in Table 1, with full definitions provided in Supplemental Table 1. Briefly, mean SBP and DBP levels were computed over all available measurements for each participant. Oscillometric BP values were calibrated to the mercury device as described previously. Antihypertensive medication classes were defined using recommendations from the 2017 ACC/AHA BP guideline.

*Validation of the web application*

We validated the web application by using it in combination with our BP and hypertension module to reproduce results from two prior studies and one CDC report. A full description of the validation procedure is available.

*Statistical analysis*

We conducted a series of statistical analyses using the BP and hypertension module defined above. We estimated characteristics of the population, crude and age-adjusted mean SBP, and prevalence of hypertension for US adults by NHANES cycle. To demonstrate computation of results by group, we computed the age-adjusted prevalence of hypertension by NHANES cycle for individuals with versus without chronic kidney disease. For age adjustment in these analyses, we used the estimated age distribution of US adults from 1999 to 2020 as the standard (49.3%, 33.6%, 10.1% and 7.0% being 18 to 44, 45 to 64, 65 to 74 and ≥75 years of age, respectively). We also estimated the number of US adults with hypertension by NHANES cycle from 1999-2000 through 2017-2020.

The age-adjusted distribution of the number of antihypertensive medication classes being taken was estimated for US adults with hypertension in each NHANES cycle, overall and among those who self-reported taking antihypertensive medication and had at least one antihypertensive drug class identified in their medication inventory. The age-adjusted proportion of US adults with controlled BP (i.e., SBP < 130 mm Hg and DBP < 80 mm Hg) was estimated by NHANES cycle among US adults with hypertension and who self-reported taking antihypertensive medication. The age-adjusted prevalence of resistant hypertension was estimated by NHANES cycle for US adults with hypertension taking antihypertensive medication and among those with hypertension taking ≥ 3 classes of antihypertensive medication. For age adjustment in these analyses, we set the age distribution for the standard population to represent US adults with hypertension from 1999 to 2020: 26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥75 years of age, respectively. We estimated the prevalence of hypertension in NHANES 2017-2020 by age group, sex, and race-ethnicity. Using the data pooling option in the application, we grouped the NHANES 2011-2020 cycles to estimate the proportion of pregnant women who had uncontrolled BP (i.e., SBP ≥ 130 mm Hg or DBP ≥ 80 mm Hg).   


**RESULTS**

The estimated crude mean SBP for all US adults was 123 mm Hg in 1999-2000, 120 mm Hg in 2009-2010, and 123 mm Hg in 2017-2020 (Figure 1; panel A). The estimated age-adjusted mean SBP was 124, 120, and 122 mm Hg in 1999-2000, 2009-2010 and 2017-2020, respectively (Figure 1; panel B). The estimated crude prevalence of hypertension among US adults was lowest in 2009-2010 (43.3%) and highest in 2017-2020 (46.6%) (Figure 2; panel A). After age-adjustment, the prevalence of hypertension was highest in 1999-2000 (47.9%), lowest in 2009-2010 and 2013-2014 (43.0%) and was 44.7% in 2017-2020. (Figure 2; panel B). The number of US adults with hypertension increased from 89.8 million in 1999-2000 to 115.3 million US adults in 2017-2020 (Figure 3). The age adjusted mean SBP was 140 in 1999-2000, 134 in 2009-2010, and 136 in 2017-2020 among US adults with hypertension and 117 in 1999-2000, 115 in 2009-2010, and 117 in 2017-2020 among US adults without hypertension (Figure S2). In each NHANES cycle, the age-adjusted estimated mean SBP was 18 to 23 mm Hg higher among US adults with versus without hypertension.  In 2017-2020, a higher percentage of US adults with versus without hypertension were non-Hispanic Black (13.5% versus 9.3%) while a lower percentage of US adults with versus without hypertension were Hispanic (12.3% versus 18.1%) (Table 1). In each NHANES cycle, the estimated age-adjusted prevalence of hypertension among US adults with CKD was higher versus their counterparts without CKD (Figure S3).

Among US adults with hypertension, 61.5% were not taking antihypertensive medication in 1999-2020 compared with 44.6% in 2017-2020. (Figure 4; panel A). Among US adults who self-reported taking antihypertensive medication, the percentage taking four or more classes of antihypertensive medication increased from 3.5% in 1999-2000 to 7.6% in 2017-2020 (Figure 4; panel B). The age-adjusted estimated prevalence of BP control among US adults with hypertension was 10.2%, 25.8%, and 23.8% in 1999-2000, 2009-2010, and 2017-2020, respectively (Figure 5; panel A). For adults who self-report taking antihypertensive medication, 26.2%, 44.1%, and 43.3% had controlled BP in 1999-2000, 2009-2010, and 2017-2020, respectively (Figure 5; panel B).

Among US adults with hypertension who self-reported taking antihypertensive medication, the prevalence of resistant hypertension was 13.7% in 1999-2000, 17.7% in 2009-2010, and 16.2% in 2017-2020 (Figure S4; panel A). Among those who were taking three or more classes of antihypertensive medication, the prevalence of resistant hypertension was 73.5%, 64.1%, and 67.9% in 1999-2000, 2009-2010, and 2017-2020, respectively (Figure S4; panel B).

In 2017-2020, the prevalence of hypertension was higher at progressively older age (Figure S5),  among men versus women (Figure S6), and among non-Hispanic Black adults versus non-Hispanic White adults, non-Hispanic Asian adults, Hispanic adults and adults from other race/ethnic groups (Figure S7).

**DISCUSSION**

In the current manuscript, we describe the development of an open-access web-based application that allows the calculation of nationally representative estimates for a number of BP-related outcomes using publicly available data from NHANES. Using this app, we generated statistics for some of these BP-related outcomes over time, both crude and adjusted by age. We also generated statistics stratified by characteristics of US adults (e.g., CKD), and by pooling multiple NHANES cycles to obtain more precise estimates when working with small group sizes. Researchers, stakeholders, and the public in general interested in BP-related outcomes can now use the current app to accomplish a variety of purposes. 

NHANES is a program specifically designed to obtain nationally representative estimates of the health and nutrition status of non-institutionalized US adults. Therefore, NHANES represents the ideal data source to obtain valid and reliable statistic on BP-related outcomes among US adults. Although NHANES data are publicly available, working with these data is not exempt of challenges. Examples of challenges that may face working with NHANES data include the need to download multiple files, even for a single NHANES cycle; combining multiple NHANES variables to create the measurement of interest, which may require dealing with missing data and questionnaire skip patterns; harmonizing definitions across multiple NHANES cycles; and the analyses of complex survey design data. NHANES has been conducted over many cycles and some of the methods have been updated over time. For example, NHANES switched from using sphygmomanometer devices to oscillometric devices to measure BP in 2017-2018. NHANES data users need to be careful when analyzing data across multiple cycles. Reducing barriers to using NHANES data will facilitate the use of these data to inform BP-related public health decisions and future research.

Several design decisions have been incorporated into the app.  We required participants to have only a single SBP and DBP to be included. This approach is consistent with several analyses conducted by CDC investigators (cite pmid 26633197, 29155682). However, mean BP and the prevalence of high BP would be lower if we required multiple BP measurements (cite pmid 23126346). Any bias resulting from this decision is likely to be small as over 95% of adult NHANES participants within one SBP and DBP measurement had three SBP and DBP measurements.  We re-calibrated the NHANES weights for the calculation of population counts (cite pmid 12500213). When estimating population counts, participants missing data on SBP, DBP or antihypertensive medication use cannot have BP or hypertension-related outcomes.  Weights were not recalibrated when estimating portions as participants missing data are removed from the numerator and denominator.  Medication classes were coded using generic names and the drug classes in the 2017 ACC/AHA BP guideline.  We recognize the NCHS recommends using Lexicon Plus®, a proprietary database, to categorize medication classes.  While the categorization of most medications is identical using generic drug names and Lexicon Plus®, some differences exist.  Many additional decisions were made regarding the definitions of variables, inclusion of study participants, and analytic approach.  We sought to make decisions that would be acceptable to people who use the app and transparent to ensure the results could be described accurately.

We were able to replicate several prior manuscripts using the app.  However, some results could not be replicated.  For example, a prior manuscript reported the prevalence of resistant hypertension defined by the 2017 ACC/AHA BP guideline to be 19.7% in 2009-2014.  When estimated by the app, the prevalence of resistant hypertension was 17.7%, 16.5% and 17.2% in 2009-2010, 2011-2012, and 2013-2014, respectively (cite pmid 30580690).  The difference in the prevalence estimates can be attributed to the approach used to categorize medication into classes. For example, the prior publication used Lexicon Plus®, which counted spironolactone as two drug classes, a potassium-sparing diuretic and an aldosterone antagonist.  Additionally, Lexicon Plus®includes Sotalol as a beta blocker and nitroglycerine as a direct vasodilator and we did not include these drugs as antihypertensive medications as they are not listed in the 2017 ACC/AHA BP guideline.  The differences in results between the app and this previously published manuscript emphasize two important points. First, while we encourage users to check results when using the app with prior publications, it may not be possible to always generate results that are identical to prior publications. Second, users should be aware of the choices made in defining variables. 

The web application has a number of complementary features that allow users to complete various analysis tasks. In particular, users can generate descriptive summaries of the US population spanning over 20 years, including summaries of characteristics and cardiometabolic outcomes. The flexibility of inclusion criteria paired with the large set of outcomes and stratifying variables available allow an enormous number of hypotheses to be explored. Outputs from the app can be included in scientific proposals, presentations, or articles, citing the application's publicly available documentation to contextualize results. With the ability to download summary data from the application, users can visualize or tabulate results with aesthetics and software of their choosing. The web application can also be used for educational purposes, as teachers can use it to analyze health outcomes for US adults interactively with students.

With an open-source software license and publicly available documentation and data, the web application we developed is designed to be extended. The Shiny interface and R codes supporting this application can support general sub-populations of NHANES participants, such as a sub-population of participants with cholesterol data or a sub-population of pediatric survey participants. As the current analysis demonstrates creation and analysis of a sub-population of participants with BP measurements, others can use it as a template for developing extensions of the web application that engage with new sub-populations. In addition to including new sub-populations of NHANES participants, the application may be extended to include inferential statistics and hypothesis testing, and may also incorporate new cycles of NHANES data as they become available.

\newpage

**Table 1**: Variables included in the blood pressure and hypertension module.

```{r}

bp_med_classes <- c(
 "bp_med_ace",
 "bp_med_aldo",
 "bp_med_alpha",
 "bp_med_angioten",
 "bp_med_beta",
 "bp_med_central",
 "bp_med_ccb",
 "bp_med_diur_Ksparing",
 "bp_med_diur_loop",
 "bp_med_diur_thz",
 "bp_med_renin_inhibitors",
 "bp_med_vasod"
)

classes <- c("Blood pressure",
             "Hypertension", 
             "Antihypertensive medication")

ft_data <- nhanes_key %>% 
 .[module == 'htn'] %>% 
 .[class %in% classes] %>% 
 .[, class := factor(class, levels = classes)] %>% 
 .[order(class)] %>% 
 .[variable %in% bp_med_classes,
   class := "Antihypertensive medication classes"] %>% 
 select(class, variable, label) %>% 
 as_grouped_data(groups = 'class') 

indent_meds_spanner <- 
 which(ft_data$class == "Antihypertensive medication classes")
indent_meds <- 
 which(ft_data$variable %in% bp_med_classes)

ft <- ft_data %>% 
 as_flextable(hide_grouplabel = TRUE,
              col_keys = c('class', 'label')) %>% 
 set_header_labels(label = "Variables included in module") %>% 
 theme_box() %>% 
 bg(i = ~ !is.na(class), bg = 'grey80') %>%
 bg(i = indent_meds_spanner, bg = 'white') %>%
 italic(i = ~ !is.na(class)) %>%
 padding(i = ~ is.na(class), padding.left = 10) %>% 
 padding(i = indent_meds_spanner, padding.left = 10) %>% 
 padding(i = indent_meds, padding.left = 20) %>% 
 width(j = 1, width = 6) %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c('BP', 'SBP', 'DBP', 'ACC', 'AHA', 'JNC7')]
  )
 )

ft

```


```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "portrait"),
    type = "continuous"
  )
)
```


**Table 2**:	Race/ethnicity distribution of the population with and without hypertension in 2017-2020

```{r}

library(table.glue)

nhanes_data %>% 
 nhanes_summarize(key = nhanes_key,
                  outcome_variable = 'demo_race',
                  group_variable = 'htn_accaha',
                  time_values = 'most_recent') %>%
 mutate(across(where(is.numeric), table_value)) %>% 
 filter(statistic == 'percentage') %>% 
 select(-statistic, 
        -ends_with("reason"),
        -unreliable_status,
        -review_needed) %>% 
 flextable() %>% 
 theme_box() %>% 
 width(width = 1) %>% 
 align(align = 'center', part = 'all') %>% 
 align(j = 1, align = 'center', part = 'all')

```

\newpage

**Figure 1** Mean systolic blood pressure for US adults by calendar year

A. Without age adjustment
```{r, fig.height=3.75}

fig_print <- function(x){
 x[[1]] %>% 
  layout(font = list(size = 40))
}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_sys_mean',
                       time_values = 'all', 
                       geom = 'bar')

age_wts_overall <- c(49.3, 33.6, 10.1, 7)

p2 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_sys_mean',
                       time_values = 'all', 
                       age_wts = age_wts_overall, 
                       geom = 'bar')

fig_print(p1)

```

B. With age adjustment through direct standardization.
```{r, fig.height=3.75}
fig_print(p2)
```

\newpage

**Figure 2** Prevalence of hypertension for US adults by calendar year

A. Without age adjustment
```{r, fig.height=3.75}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'htn_accaha',
                       time_values = 'all', 
                       geom = 'bar')

p2 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'htn_accaha',
                       time_values = 'all', 
                       age_wts = age_wts_overall, 
                       geom = 'bar')

fig_print(p1)

```

B. With age adjustment through direct standardization.
```{r, fig.height=3.75}
fig_print(p2)
```


```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all',
                 group_variable = 'cc_ckd',
                 age_wts = age_wts_overall, 
                 geom = 'point',
                 size_point = 22,
                 size_error = 4) %>% 
 fig_print()

```

\newpage

**Figure 3** Number of US adults with hypertension

```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all',
                 statistic_primary = 'count',
                 geom = 'bar') %>% 
 fig_print()

```

\newpage

**Figure 4** Distribution of the number of antihypertensive medication classes being taken among those with hypertension by calendar period

A. Among those with hypertension
```{r, fig.height=3.75}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_med_n_class',
                       subset_variables = list('htn_accaha'),
                       subset_values = list("Yes"),
                       time_values = 'all', 
                       geom = 'bar')

p2 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_med_n_class',
                       subset_variables = list('htn_accaha', 'bp_med_use'),
                       subset_values = list("Yes", "Yes"),
                       time_values = 'all', 
                       geom = 'bar')

fig_print(p1)

```

B. Among those with hypertension who self-report taking antihypertensive medication 
```{r, fig.height=3.75}
fig_print(p2)
```


\newpage

**Figure 5** Blood pressure control by calendar year

A. Age-adjusted among those with hypertension
```{r, fig.height=3.75}

age_wts_htn <- c(26.4, 43.5, 17.0, 13.2)

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_control_accaha',
                       subset_variables = list('htn_accaha'),
                       subset_values = list("Yes"),
                       age_wts = age_wts_htn,
                       time_values = 'all', 
                       geom = 'bar')

p2 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_control_accaha',
                       subset_variables = list('htn_accaha',
                                               'bp_med_use'),
                       subset_values = list("Yes", 
                                            "Yes"),
                       age_wts = age_wts_htn,
                       time_values = 'all', 
                       geom = 'bar')



fig_print(p1)

```

B. Age-adjusted among those who self-report taking antihypertensive medication 
```{r, fig.height=3.75}
fig_print(p2)
```

\newpage

**Table S1**

```{r}

classes <-
 c("Survey",
   "Demographics",
   "Blood pressure",
   "Hypertension",
   "Antihypertensive medication",
   "Comorbidities")

ft_data <- nhanes_key %>% 
 .[class %in% classes] %>%
 .[variable != 'svy_subpop_chol'] %>% 
 .[, class := factor(class, levels = classes)] %>% 
 .[order(class)] %>% 
 .[variable %in% bp_med_classes,
   class := "Antihypertensive medication classes"] %>% 
 select(class, variable, label, description) %>% 
 as_grouped_data(groups = 'class') 

indent_meds_spanner <- 
 which(ft_data$class == "Antihypertensive medication classes")

indent_meds <- 
 which(ft_data$variable %in% bp_med_classes)

ft <- ft_data %>% 
 as_flextable(hide_grouplabel = TRUE,
              col_keys = c('class', 'label', 'description')) %>% 
 set_header_labels(label = "All variables included in module",
                   description = "Variable definition") %>% 
 theme_box() %>% 
 bg(i = ~ !is.na(class), bg = 'grey80') %>%
 bg(i = indent_meds_spanner, bg = 'white') %>%
 italic(i = ~ !is.na(class)) %>%
 padding(i = ~ is.na(class), j = 1, padding.left = 10) %>% 
 padding(i = indent_meds_spanner, j = 1, padding.left = 10) %>% 
 padding(i = indent_meds, j = 1, padding.left = 20) %>% 
 width(j = 1, width = 2) %>%
 width(j = 2, width = 7) %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c('BP', 'SBP', 'DBP', 'ACC', 'AHA', 'JNC7')]
  )
 )

ft

```


\newpage

**Figure S1** Application of inclusion and exclusion criteria for the application of NHANES hypertension data.

```{r}

data.frame(
 check.names = FALSE,
 ` ` = c(
  "Participants",
  "\u2265 18 years old",
  "Completed interview and examination",
  "Had SBP and DBP measurements",
  "Had self-reported information on antihypertensive medication",
  "Final Sample size"
 ),
 Overall = c(107622, 63041, 59799, 56286, 56035, 56035),
 `1999-2000` = c(9965, 5448, 4976, 4755, 4694,   4694),
 `2001-2002` = c(11039, 5993, 5592, 5251, 5184,  5184),
 `2003-2004` = c(10122, 5620, 5303, 4902, 4838,  4838),
 `2005-2006` = c(10348, 5563, 5334, 5028, 5015,  5015),
 `2007-2008` = c(10149, 6228, 5995, 5670, 5665,  5665),
 `2009-2010` = c(10537, 6527, 6360, 6053, 6043,  6043),
 `2011-2012` = c(9756, 5864, 5615, 5436, 5337,   5337),
 `2013-2014` = c(10175, 6113, 5924, 5700, 5694,  5694),
 `2015-2016` = c(9971, 5992, 5735, 5557, 5552,   5552),
 `2017-2020` = c(15560, 9693, 8965, 8024, 8013,  8013)
) %>% 
 flextable() %>% 
 theme_box() %>% 
 width(width = 0.8) %>% 
 width(j = 1, width = 1) %>% 
 align(align = 'center', part = 'all') %>% 
 align(j = 1, part = 'all')

```


\newpage

**Figure S2**:	Age-adjusted mean systolic blood pressure among people with and without hypertension

```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_sys_mean',
                 time_values = 'all',
                 group_variable = 'htn_jnc7',
                 age_wts = age_wts_overall, 
                 geom = 'bar') %>% 
fig_print()

```

\newpage

**Figure S3**: Age-adjusted prevalence of hypertension among US adults with and without chronic kidney disease
\newpage

**Figure S4**: Prevalence of resistant hypertension by calendar year 

A. Among those with hypertension who self report taking antihypertensive medication 
```{r, fig.height=3.75}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'htn_resistant_accaha',
                       subset_variables = list('htn_accaha', 'bp_med_use'),
                       subset_values = list("Yes", "Yes"),
                       time_values = 'all', 
                       geom = 'bar')

p2 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'htn_resistant_accaha',
                       subset_variables = list('htn_accaha', 
                                               'bp_med_use',
                                               'bp_med_n_class'),
                       subset_values = list("Yes", 
                                            "Yes",
                                            c('Three', 'Four or more')),
                       time_values = 'all', 
                       geom = 'bar')

fig_print(p1)

```

B. Among those with hypertension who self report and are taking 3+ classes of antihypertensive medication
```{r, fig.height=3.75}
fig_print(p2)
```
\newpage

**Figure S5** Prevalence of hypertension by age categories in 2017-2020

```{r}
nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 group_variable =  'demo_age_cat',
                 time_values = 'most_recent',
                 geom = 'bar') %>% 
 fig_print()
```
\newpage

**Figure S6** Prevalence of hypertension by sex in 2017-2020

```{r}
nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 group_variable = 'demo_gender',
                 time_values = 'most_recent',
                 geom = 'bar') %>% 
 fig_print()
```

\newpage

**Figure S7** Prevalence of hypertension by race/ethnicity in 2017-2020

```{r}
nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 group_variable = 'demo_race',
                 time_values = 'most_recent',
                 geom = 'bar') %>% 
 fig_print()
```

\newpage

**Figure S8** Prevalence of uncontrolled blood pressure among pregnant women from 2011-2012 through 2017-2020.

```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_uncontrolled_accaha',
                 time_values = c("2011-2012", 
                                 "2013-2014",
                                 "2015-2016",
                                 "2017-2020"),
                 pool = TRUE,
                 subset_variables = list('demo_pregnant'),
                 subset_values = list("Yes"),
                 geom = 'bar') %>% 
 fig_print()

```

```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "landscape"),
    page_margins = page_mar(bottom = 1/8, top = 1/8, 
                            right = 1/4, left = 1/4),
    type = "continuous"
  )
)
```

