---
title: "Hypertension statistics for US adults: an open-source web application for analysis and visualization of US NHANES data"
always_allow_html: true
bibliography: refs.bib
csl: jama.csl
output: 
  officedown::rdocx_document:
    reference_docx: style_manuscript_times_new_roman.docx
    keep_md: true
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
 echo = FALSE,
 message = FALSE,
 warning = FALSE,
 fig.width = 10.5,
 fig.height = 4, 
 dpi = 300,
 ft.keepnext = FALSE
)

suppressPackageStartupMessages({
 library(officer)
 library(cardioStatsUSA)
 library(magrittr)
 library(gtsummary)
 library(tidyverse)
 library(survey)
 library(flextable)
 library(plotly)
})

conflicted::conflict_prefer('as_flextable', 'flextable')
conflicted::conflict_prefer('filter', 'dplyr')
conflicted::conflict_prefer('layout', 'plotly')

# define age weights for standardization
standard_weights_overall <- c(49.3, 33.6, 10.1, 7)
standard_weights_htn <- c(26.4, 43.5, 17.0, 13.2)

# default is double space 
# single spacing for title page, abstract, captions
single_par <- fp_par(line_spacing=1)


abbrvs <- list(
  "CI"     = 'confidence interval',
  "BP"     = "blood pressure",
  "SBP"    = "systolic blood pressure",
  "DBP"    = "diastolic blood pressure",
  "SD"     = 'standard deviation',
  "IQR"    = 'interquartile range',
  "JNC7"   = "Seventh Joint National Committee",
  "ACC"    = "American College of Cardiology",
  "AHA"    = "American Heart Association",
  "ASCVD"  = "atherosclerotic cardiovascular disease",
  "CVD"    = 'cardiovascular disease',
  "HbA1c"  = "hemoglobin A1C",
  "ACE"    = "angiotensin-converting enzyme",
  "NHANES" = "National Health and Nutrition Examination Survey"
)

abbrvs_paste <- function(strings){
  
  front <- 'Abbreviations'
  
  matter <- glue::glue_collapse(strings, sep = '; ', last = '; and ')
  
  paste(front, matter, sep = ': ')
  
}

abbrvs_write <- function(abbr){
  
  sorted <- abbr[sort(names(abbr))]
  
  strings <- map2_chr(names(sorted), sorted, paste, sep = ' = ')
  
  abbrvs_paste(strings)
  
}


```

Byron C. Jaeger, PhD,^1^ 
Ligong Chen, PhD,^2^
Kathryn Foti, PhD, MPH^2^
Shakia T. Hardy,^2^
Adam P. Bress, PharmD, MS,^3,4^ 
Sean P. Kane, PharmD, BCPS,^5^
Jennifer S. Herrick, MS,^3,6^
Catherine Derington, PharmD, MS,^7^ 
Bharat Poudel, MSPH,^2^
Ashley Christenson, BS,^2^ 
Lisandro D. Colantonio, MD, PhD,^2^
Paul Muntner, PhD,^2^

**AUTHOR ORDER NOT FINALIZED**


^1^Department of Biostatistics and Data Science, Wake Forest School of Medicine, Winston-Salem, NC. `r single_par`
^2^Department of Epidemiology, University of Alabama at Birmingham, Birmingham, AL. `r single_par`
^3^Informatics, Decision-Enhancement, and Analytic Sciences (IDEAS) Center, Veterans Affairs, Salt Lake City Health Care System, Salt Lake City, UT. `r single_par`
^4^Department of Population Health Sciences, University of Utah School of Medicine, Salt Lake City, UT. `r single_par`
^5^Department of Pharmacy Practice, Rosalind Franklin University of Medicine and Science, North Chicago, IL, USA
^6^Department of Internal Medicine, University of Utah School of Medicine, Salt Lake City, UT
^7^ University of Colorado Skaggs School of Pharmacy and Pharmaceutical Sciences, Aurora, CO, USA

\newpage

# ABSTRACT

**Background**: Data from the US National Health and Nutrition Examination Survey (NHANES) are freely available and can be analyzed to produce hypertension statistics for the non-institutionalized US population. The analysis of these data requires statistical programming knowledge.

**Methods**: We developed and validated a web-based application that provides hypertension statistics for US adults using 10 cycles of NHANES data, 1999-2000 through 2017-2020, without requiring users to conduct statistical programming. The application's interface allows users to estimate crude and age-adjusted means, quantiles, and proportions. Population counts can also be estimated. To demonstrate the application’s capabilities, we estimated hypertension statistics for US adults.The application was validated by replicating statistics from three publications.

**Results**: The estimated mean systolic blood pressure (BP) declined from 123 mmHg in 1999-2000 to 120 mmHg in 2009-2010 and increased to 123 mmHg in 2017-2020. The age-adjusted prevalence of hypertension (i.e., systolic BP ≥130 mmHg, diastolic BP ≥80 mmHg or self-reported antihypertensive medication use) was 47.9% in 1999-2000, 43.0% in 2009-2010, and 44.7% in 2017-2020. In 2017-2020, 115.3 million US adults had hypertension. The age-adjusted prevalence of controlled BP, defined by the 2017 American College of Cardiology/American Heart Association BP guideline, among non-pregnant US adults with hypertension was 9.7% in 1999-2000, 25.0% in 2013-2014, and 21.9% in 2017-2020. After age-adjustment and among non-pregnant US adults who self-reported taking antihypertensive medication, 27.6%, 48.5%, and 43.0% had controlled BP in 1999-2000, 2013-2014, and 2017-2020, respectively.

**Conclusions**: The application developed in the current study is publicly available and produced valid, transparent, and reproducible results.

\newpage

The National Health and Nutrition Examination Survey (NHANES) is a program conducted by the US National Center for Health Statistics (NCHS) of the Centers for Disease Control and Prevention (CDC) and is designed to assess the ongoing health and nutritional status of the non-institutionalized US population.[@nhanes_about] NHANES data have been analyzed to provide hypertension statistics for non-institutionalized US adults with important policy and public health implications. For example, NHANES data have been used to estimate the impact of the lower blood pressure (BP) levels that define hypertension and controlled BP in the 2017 American College of Cardiology/American Heart Association (ACC/AHA) BP guideline versus the Seventh Report of the Joint National Committee on Prevention, Detection, Evaluation, and Treatment of High BP (JNC7) guideline.[@muntner_potential_2018] Additionally, NHANES data have been used to track the proportion of US adults with hypertension that have controlled BP, which were included in a Call-to-Action to Control BP from the US Surgeon General.[@us_surgeon_2020]

<br>

NHANES data are publicly available and accessible through the CDC website.[@nhanes_home; @nhanes_data] However, analyzing NHANES data may be challenging for a number of reasons. Specific statistical techniques are required to account for the multi-stage sampling design used to select NHANES participants and analyses need to be weighted to produce nationally representative estimates. NHANES data are currently collected in two-year periods, referred to as cycles, and each cycle includes over 50 data files and accompanying informational material. NHANES data collection protocols have changed over time for some variables, and these differences should be considered when comparing or aggregating data from multiple cycles. For example, while BP was measured using a mercury sphygmomanometer until 2016,[@centers2015national] a validated oscillometric device was used in 2017 through 2020.[@ostchega2010assessing] Also, tests need to be performed to ensure the statistical estimates are reliable, and unstable estimates should be suppressed.[@parker2017national]



<br>

We developed an open-source web-based application that provides nationally representative BP and hypertension statistics for non-institutionalized US adults using NHANES data without requiring users to conduct statistical programming. The goal of the application is to increase the use of NHANES data for research and policy decision making with a focus on ensuring results are valid and reproducible. The application is also "open-source" as it's source code is publicly available. In this manuscript, we review the design, development and validation of the application and present BP and hypertension statistics for US adults that were generated using the application.

<br>

# METHODS

The NHANES program was initiated in the early 1960s and beginning in 1999 has been conducted continuously, in two-year cycles. In each cycle, potential participants were identified using a multi-stage sampling process. The protocols for each cycle were approved by the NCHS Institutional Review Board. Written informed consent was obtained from each participant.

<br>

NHANES data were collected through an in-home interview and study examination conducted at a mobile examination center. The interview included questions about demographics, health behaviors, medical history, and medication use. During the interview, the labels of medications that participants reported taking in the preceding 30 days were recorded. Antihypertensive medication classes were defined using those listed in the 2017 ACC/AHA BP guideline.[@whelton20182017] During the study examination, height, weight and BP were measured and blood and spot urine samples were collected. Of relevance to the current application, blood samples were used to measure total and high-density lipoprotein cholesterol, glycated hemoglobin and serum creatinine, and the urine sample was used to measure albumin and creatinine and to conduct a pregnancy test. The protocol for measuring BP is available online.[@ostchega_national_2003] In brief, systolic and diastolic BP (SBP and DBP, respectively) were measured three times by trained and certified physicians. BP was measured using a mercury sphygmomanometer from 1999-2000 through 2015-2016 and using an oscillometric device in 2017-2020. The mean SBP and DBP levels were computed over all available measurements for each participant. The oscillometric SBP and DBP values were calibrated to the mercury device.[@muntner2022blood; @ostchega2021comparing] For the current analysis, we defined hypertension, BP control, and resistant hypertension according to the 2017 ACC/AHA BP guideline.[@whelton20182017] The application also has these variables defined according to the JNC7 definitions.[@chobanian2003seventh] Chronic kidney disease (CKD) was defined by estimated glomerular filtration rate < 60 ml/min/1.73 m^2^ calculated using the 2021 serum creatinine-based equation or albumin-to-creatinine ratio > 30 mg/g.[@inker_new_2021] A list of BP, hypertension, and antihypertensive medication variables is provided in **Table 1** with full definitions for all variables provided in **Table S1**.

<br>

```{r, echo=FALSE}
n_included <- 
 table.glue::table_value(sum(nhanes_data$svy_subpop_htn))
```


There were 107,622 NHANES participants in the 10 cycles from 1999-2000 to 2017-2020. We restricted the dataset to adults ≥ 18 years of age. This exclusion was applied because statistics for BP levels and the prevalence of hypertension in children and adolescents are markedly different than for adults.[@muntner2004trends] We further restricted the population to participants who completed the in-home interview and study examination, with one or more SBP and DBP measurement, and who had data on self-reported antihypertensive medication use. After these exclusions were applied, the population in the current application included `r n_included` participants (**Figure S1**).

<br>

## Features of the web application

A full summary of this application’s features and associated tutorials are available online.[@rpack_cardioStatsUSA] Briefly, users can select NHANES cycles from 1999-2000 to 2017-2020 to be analyzed. Estimates are weighted to represent the non-institutionalized US population and users may incorporate age-adjustment through direct standardization. Users can restrict analyses to subsets of participants (e.g., participants who self-reported taking antihypertensive medication). When population count estimates are requested, survey weights are calibrated within race, sex, and age groups to account for missing information on SBP, DBP or self-reported antihypertensive medication use. The results can be presented in tables or figures and for the overall population or in subgroups. All tables and figures created with the web application can be downloaded and saved in standard formats. Following CDC recommendations, unreliable statistical estimates are automatically suppressed.[@parker2017national] To increase precision and reliability of estimates, contiguous NHANES cycles can be combined.[@nhanes_tutorial_weights]

<br>

## Development and validation of the web application

The web application was created using Shiny,[@rpack_shiny; @rpack_shinyWidgets; @rpack_shinyalert] an open-source software package that translates code from the R programming language into HTML, CSS, or JavaScript commands and creates a website interface.[@r_language] We created the “cardioStatsUSA” R package to provide additional details on the web application’s design and comprehensive documentation of its components.[@rpack_cardioStatsUSA] We validated the web application by using it to reproduce statistics reported in two prior studies and one CDC report.[@muntner2020htn; @muntner2022blood; @fryar_hypertension_2017]

<br>

## Statistical analysis

We performed statistical analyses to demonstrate core features of the application. We estimated the mean SBP for US adults by NHANES cycle, 1999-2000 through 2017-2020, with points and error bars representing the estimated means and 95% confidence intervals (CI), respectively. We made bar charts presenting the age-adjusted prevalence of hypertension and the estimated number of US adults with hypertension. For age adjustment, we used the estimated age distribution of US adults from 1999 to 2020 as the standard (49.3%, 33.6%, 10.1% and 7.0% being 18 to 44, 45 to 64, 65 to 74 and ≥ 75 years of age, respectively). We created a table of the estimated race/ethnicity distribution of US adults with and without hypertension, separately. We demonstrated stratification by estimating the prevalence of hypertension by NHANES cycle for US adults with and without CKD. We showed the application’s ability to suppress output when statistical estimates are unstable by attempting to estimate the distribution of BP categories (SBP/DBP < 120/80 mm Hg, 120-129/<80 mm Hg, 130-139/80-89 mm Hg, 140-159/90-99 mm Hg and ≥ 160/100 mm Hg) among pregnant women in 2017-2020. We then showed that reliable estimates can be obtained for the distribution of BP categories among pregnant women by pooling NHANES cycles from 2009-2010 through 2017-2020.

<br>

We also illustrated how core features of the application can be combined to perform customized analyses. Specifically, we estimated the age-adjusted proportion of US adults with controlled BP by NHANES cycle among non-pregnant US adults with hypertension, overall and among those who self-reported taking antihypertensive medication. We also estimated the age-adjusted prevalence of resistant hypertension by NHANES cycle for non-pregnant US adults with hypertension who self-reported taking antihypertensive medication and had ≥ 1 classes of antihypertensive medication identified during the medication inventory and among those with ≥ 3 classes of antihypertensive medication identified during the medication inventory. For age adjustment in the analysis of BP control and resistant hypertension, we set the age distribution for the standard population to represent US adults with hypertension from 1999 to 2020: 26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥ 75 years of age, respectively.

<br>

# RESULTS

Among non-institutionalized US adults ≥ 18 years of age, the estimated mean SBP was 123 (95% CI 121, 124) mm Hg in 1999-2000, 120 (95% CI 120, 121) mm Hg in 2009-2010 and 123 (95% CI 122, 124) mm Hg in 2017-2020 (**Figure 1**).  The age-adjusted prevalence of hypertension was highest in 1999-2000 (47.9%), lowest in 2009-2010 (43.0%), and 44.7% in 2017-2020 (**Figure 2**). In 1999-2000, there were an estimated 89.8 million US adults with hypertension (**Figure 3**). The number of US adults with hypertension increased to 115.3 million in 2017-2020.  In each NHANES cycle, the estimated prevalence of hypertension was higher among US adults with versus without CKD (**Figure S2**). In 2017-2020, a higher percentage of US adults with versus without hypertension were non-Hispanic Black (13.5% versus 9.3%) while a lower percentage of US adults with versus without hypertension were Hispanic (12.3% versus 18.1%) (**Table 2**). Among pregnant women, the distribution of BP categories could not be estimated reliably in 2017-2020 (**Figure S3; Panel A**), but it could be estimated reliably after pooling NHANES cycles from 2009-2010 through 2017-2020 (**Figure S3; Panel B**)

<br>

The age-adjusted prevalence of BP control among non-pregnant US adults with hypertension was lowest in 1999-2000 (9.7%), highest in 2013-2014 (25.0%), and 21.9% in 2017-2020 (**Figure 4; panel A**). Among US adults with hypertension who self-reported taking antihypertensive medication, 27.6%, 48.5%, and 43.0% had controlled BP in 1999-2000, 2013-2014, and 2017-2020, respectively (**Figure 4; panel B**). The age-adjusted prevalence of resistant hypertension among non-pregnant US adults with hypertension who self-reported taking antihypertensive medication and had ≥1 antihypertensive medication class identified during the medication inventory was lowest in 1999-2000 (14.3%), highest in 2005-2006 (21.4%), and 16.6% in 2017-2020 (**Figure S4; panel A**). Further restricting this analysis to those who were taking three or more classes of antihypertensive medication, the prevalence of resistant hypertension was lowest in 2009-2010 (64.1%), highest in 2003-2004 (78.3%), and 67.9% in 2017-2020 (**Figure S4; panel B**).

<br>

# DISCUSSION

In the current manuscript, we present a web application with a user-friendly point and click interface that allows the calculation of nationally representative estimates for BP, hypertension and antihypertensive medication-related statistics using publicly available NHANES data. Using this application, we generated crude and age-adjusted BP and hypertension statistics. Also, we generated statistics stratified by characteristics of US adults and pooling multiple NHANES cycles to obtain more precise estimates when working with the small sub-group of pregnant women. Following its validation, version 0.0.1 of the application was released and deployed on a publicly available server on **DATE TBD (it's almost ready)**.[@app_cardioStatsUSA] Researchers, clinicians, and the public can use the application to generate customized BP and hypertension statistics for US adults to inform their research and policy decisions.

<br>

NHANES was designed to obtain nationally representative estimates of the health and nutrition status of non-institutionalized US adults and is an ideal data source to obtain statistics related to hypertension. SBP and DBP were measured following a standardized protocol by trained and certified physicians.  NHANES data are publicly available to download, but working with these data requires understanding variable definitions and advanced programming and statistical knowledge. Challenges of analyzing NHANES data may also include downloading and merging multiple data files, even for a single NHANES cycle; combining multiple variables to create outcome definitions, which may require dealing with missing data and questionnaire skip patterns; harmonizing variables across multiple NHANES cycles; and the analysis of complex survey design data. Although multiple reports based on the data are publicly available, it may be difficult to customize reports based on user requests. The web application that we present in the current manuscript addresses these challenges, allowing NHANES data to more fully inform public health decisions and future research related to hypertension.

<br>

Several design decisions have been incorporated into the application. We required participants to have a single SBP and DBP to be included while some prior analyses required three SBP and DBP measurements.[@muntner_potential_2018]  We chose an approach that is consistent with several analyses conducted by CDC investigators.[@yoon_hypertension_2015; @fryar_hypertension_2017] However, mean BP and the prevalence of high BP may be lower if we required multiple BP measurements.[@handler_impact_2012] Any bias resulting from this decision is likely to be small as over 95% of adult NHANES participants with at least one SBP and DBP measurement had three SBP and DBP measurements. The application re-calibrates the NHANES weights for the estimation of population counts.[@coresh_prevalence_2003] This was done because participants missing data on SBP, DBP or antihypertensive medication use cannot have BP or hypertension-related outcomes. Weights were not re-calibrated when estimating proportions as participants missing data are removed from the numerator and denominator. Medication classes were coded using generic names and the drug classes in the 2017 ACC/AHA BP guideline. We recognize the NCHS recommends using Lexicon Plus®, a proprietary database, to categorize medication classes.[@nhanes_rxq_drug] While the categorization of most medications is identical using generic drug names and Lexicon Plus®, some differences exist. Many additional decisions were made regarding the definitions of variables, inclusion of study participants, and analytic approach. We sought to make decisions that would be widely acceptable and transparent to ensure the results could be described accurately.

<br>

Using the application, we replicated results from several prior manuscripts.[@muntner2020htn; @muntner2022blood; @fryar_hypertension_2017] However, we were not able to replicate some results.[@carey_prevalence_2019] For example, a prior manuscript reported the prevalence of resistant hypertension defined by the 2017 ACC/AHA BP guideline to be 19.7% in 2009-2014.[@carey_prevalence_2019] When estimated by the application, the prevalence of resistant hypertension over this time period was 17.1%. The difference in the prevalence estimates can be attributed to the approach used to categorize antiyhpertensive medications into their medication classes. The prior publication used Lexicon Plus®, which counted spironolactone as two drug classes, a potassium-sparing diuretic and an aldosterone antagonist. We included spironolactone as a single drug class, an aldosterone antagonist. Additionally, Lexicon Plus® includes sotalol as a beta blocker and nitroglycerine as a direct vasodilator and we did not include these drugs as antihypertensive medications as they are not listed in the 2017 ACC/AHA BP guideline.[@whelton20182017] The differences in results between the application and this previously published manuscript emphasize that it may not be possible to always generate results that are identical to prior publications. Users should be aware of the choices made in defining variables as this may affect the statistical estimates generated using the application.

<br>

The application has a number of features that can be used in combination to create highly customized statistics. Variables can be analyzed as outcomes or used to stratify results or restrict analyses to subsets of participants.  Combining the variables, tens of thousands of unique statistics can be estimated using the application. In addition, users can generate statistics for US adults from 1999-2000 to 2017-2020, pooling results or stratifying the data. All results from the application can be saved as an image and included in scientific proposals or presentations. In addition, the ability to download results as a data set from the application allows users to further customize their results in tabular or graphical formats. 

<br>

## Strengths/limitations

This study has a number of strengths. We used NHANES data, which are publicly available, rigorously collected, and allow for estimation of nationally representative statistics. Also, we leveraged open-source software to ensure that our application is transparent and freely available. This study also has several limitations. NHANES participants had their mean BP measured during a single visit, and BP guidelines recommend obtaining mean BP using at least two BP values measured on separate days.[@whelton20182017] The response rate for NHANES has declined from 1999-2000 through 2017-2020. Effects of this decline are unclear.

<br>

## Conclusions

We developed a web-based application for analysis of hypertension statistics among non-institutionalized adults living in the US from 1999-2000 through 2017-2020. The application is publicly available and produces valid, transparent, and reproducible results.

\newpage

# REFERENCES

<div id="refs"></div>

\newpage

# FUNDING/SUPPORT

**this section is under construction and should be checked for correctness**

Drs Muntner and Jaeger receive support through grant R01HL144773 from the National Heart, Lung, and Blood Institute. Drs Muntner and Hardy receive support through grant R01HL117323 from the National Heart, Lung, and Blood Institute. Dr Muntner receives support through grant R01HL139716 from the National Heart, Lung, and Blood Institute.

# FINANCIAL DISCLOSURE 

**this section is under construction and should be checked for correctness**

Dr Muntner reported receiving grant funding and consulting fees from Amgen Inc. Dr Colantonio reported receiving grant funding from Amgen Inc. No other disclosures were reported.

\newpage

### Table 1: Blood pressure, hypertension and antihypertensive medication variables that are available in the web application.

```{r}

bp_med_classes <- c(
 "bp_med_ace",
 "bp_med_aldo",
 "bp_med_alpha",
 "bp_med_angioten",
 "bp_med_beta",
 "bp_med_central",
 "bp_med_ccb",
 "bp_med_diur_Ksparing",
 "bp_med_diur_loop",
 "bp_med_diur_thz",
 "bp_med_renin_inhibitors",
 "bp_med_vasod"
)

classes <- c("Blood pressure",
             "Hypertension", 
             "Antihypertensive medication")

ft_data <- nhanes_key %>% 
 .[module == 'htn'] %>% 
 .[class %in% classes] %>% 
 .[, class := factor(class, 
                     levels = classes,
                     labels = paste(classes, 'domain'))] %>% 
 .[order(class)] %>% 
 .[variable %in% bp_med_classes,
   class := "Antihypertensive medication classes"] %>% 
 select(class, variable, label) %>% 
 as_grouped_data(groups = 'class') 

indent_meds_spanner <- 
 which(ft_data$class == "Antihypertensive medication classes")

indent_meds <- 
 which(ft_data$variable %in% bp_med_classes)

ft <- ft_data %>% 
 as_flextable(hide_grouplabel = TRUE,
              col_keys = c('class', 'label')) %>% 
 set_header_labels(label = "Variable") %>% 
 theme_box() %>% 
 bg(i = ~ !is.na(class), bg = 'grey80') %>%
 bg(i = indent_meds_spanner, bg = 'white') %>%
 italic(i = ~ !is.na(class)) %>%
 padding(i = ~ is.na(class), padding.left = 10) %>% 
 padding(i = indent_meds_spanner, padding.left = 10) %>% 
 padding(i = indent_meds, padding.left = 20) %>% 
 width(j = 1, width = 6) %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c('BP', 'SBP', 'DBP', 'ACC', 'AHA', 'JNC7')]
  )
 )

ft

```


```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "portrait"),
    type = "continuous"
  )
)
```


### Table 2:	Race/ethnicity distribution of US adults with and without hypertension in 2017-2020

```{r}

library(table.glue)

rspec <- round_spec() %>% 
 round_using_decimal(digits = 1)

nhanes_data %>% 
 nhanes_summarize(key = nhanes_key,
                  outcome_variable = 'demo_race',
                  group_variable = 'htn_accaha',
                  time_values = 'most_recent') %>%
 mutate(
  across(where(is.numeric), 
         .fns = table_value, 
         rspec = rspec)
 ) %>% 
 filter(statistic == 'percentage') %>% 
 flextable() %>% 
 theme_box() %>% 
 width(width = 0.875) %>% 
 width(j = ~demo_race, width = 1) %>% 
 width(j = ~statistic, width = 1) %>% 
 width(j = ~unreliable_reason, width = 0.7) %>% 
 width(j = ~review_reason, width = 0.7) %>% 
 align(align = 'center', part = 'all') %>% 
 align(j = 1, align = 'center', part = 'all') %>% 
 add_footer_lines(
  values = "Table format is identical to the web application's output."
 ) %>% 
 add_footer_lines(
  values = "svy_year indicates the NHANES cycle"
 ) %>% 
 add_footer_lines(
  values = "htn_accaha indicates hypertension status." 
 ) %>% 
 add_footer_lines(
  values = "demo_race indicates the race subgroup."
 ) %>% 
 add_footer_lines(
  values = "statistic indicates the type of statistic computed."
 ) %>% 
 add_footer_lines(
  values = "estimate is the point estimate of the given statistic"
 ) %>% 
 add_footer_lines(
  values = "std_error is the standard error for estimate"
 ) %>% 
 add_footer_lines(
  values = "ci_lower is the lower bound of a 95% confidence interval for estimate"
 ) %>% 
 add_footer_lines(
  values = "ci_upper is the upper bound of a 95% confidence interval for estimate"
 ) %>% 
 add_footer_lines(
  values = "n_obs is the number of observations (unweighted) used for computations"
 ) %>% 
 add_footer_lines(
  values = "unreliable_status is TRUE if the result is unreliable, FALSE otherwise"
 ) %>% 
 add_footer_lines(
  values = "unreliable_reason is blank if the result is reliable, and lists reason(s) for unreliability otherwise"
 ) %>% 
 add_footer_lines(
  values = "review_needed is TRUE if the result should be reviewed, FALSE otherwise"
 ) %>% 
 add_footer_lines(
  values = "review_reason is blank if the result does not require review, and lists reason(s) for requiring review otherwise"
 )  


```

\newpage

```{r footer_functions}

footer_hover <- function(parenthetical,
                         hover_over){
 
 glue::glue(
 "The graph is identical to the web application's output. \\
 All values ({parenthetical}) can be obtained in the app \\
 by hovering over {hover_over}."
 )
 
}

```


### Figure 1: Mean systolic blood pressure for US adults by calendar year

```{r, fig.height=3.75}

fig_print <- function(x){
 x[[1]] %>% 
  layout(font = list(size = 40))
}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_sys_mean',
                 time_values = 'all', 
                 geom = 'points',
                 size_point = 25,
                 size_error = 1) %>% 
 fig_print()

```
Dots represent mean systolic blood pressure. Vertical lines represent the 95% confidence interval. `r single_par`

`r footer_hover(parenthetical = "estimated mean and the upper and lower limits of the 95% confidence interval", hover_over = "the mean systolic blood pressure")` `r single_par`

\newpage


### Figure 2: Age-adjusted prevalence of hypertension for US adults by calendar year

```{r, fig.height=3.75}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all', 
                 standard_weights = standard_weights_overall, 
                 geom = 'bar') %>% 
 fig_print()

```
Age adjustment was performed through direct standardization, using the estimated age distribution of US adults from 1999 to 2020 as the standard (49.3%, 33.6%, 10.1% and 7.0% being 18 to 44, 45 to 64, 65 to 74 and ≥ 75 years of age, respectively). `r single_par`

`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

\newpage

### Figure 3: Number of US adults with hypertension by calendar year

```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all',
                 statistic_primary = 'count',
                 geom = 'bar') %>% 
 fig_print()

```
`r footer_hover(parenthetical = "estimated count and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

\newpage


### Figure 4: Age-adjusted prevalence of blood pressure control by calendar year.

A. Among non-pregnant US adults with hypertension `r single_par`
```{r, fig.height=3.75}

p1 <- 
 nhanes_visualize(
  data = nhanes_data,
  key = nhanes_key,
  outcome_variable = 'bp_control_accaha',
  subset_calls = list("htn_accaha" = "Yes",
                      "demo_pregnant" = c("No", "Missing")),
  standard_weights = standard_weights_htn,
  time_values = 'all', 
  geom = 'bar')

p2 <- 
 nhanes_visualize(
  data = nhanes_data,
  key = nhanes_key,
  outcome_variable = 'bp_control_accaha',
  subset_calls = list("htn_accaha" = "Yes",
                      "bp_med_use" = "Yes",
                      "demo_pregnant" = c("No", "Missing")),
  standard_weights = standard_weights_htn,
  time_values = 'all', 
  geom = 'bar'
 )


fig_print(p1)

```
Age adjustment was performed through direct standardization, using the estimated age distribution of US adults with hypertension from 1999 to 2020 as the standard (26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥ 75 years of age, respectively) `r single_par`

`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

Survey participants with missing values for pregnancy status were assumed to be non-pregnant `r single_par`

\newpage

B. Among non-pregnant US adults who self-report taking antihypertensive medication `r single_par`
```{r, fig.height=3.75}
fig_print(p2)
```
Age adjustment was performed through direct standardization, using the estimated age distribution of US adults with hypertension from 1999 to 2020 as the standard (26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥ 75 years of age, respectively) `r single_par`

`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

Survey participants with missing values for pregnancy status were assumed to be non-pregnant `r single_par`

\newpage

### Table S1: Definitions of variables included in the web-based application.

```{r}

classes <-
 c("Survey",
   "Demographics",
   "Blood pressure",
   "Hypertension",
   "Antihypertensive medication",
   "Comorbidities")

ft_data <- nhanes_key %>% 
 .[class %in% classes] %>%
 .[variable != 'svy_subpop_chol'] %>% 
 .[, class := factor(class, levels = classes)] %>% 
 .[order(class)] %>% 
 .[variable %in% bp_med_classes,
   class := "Antihypertensive medication classes"] %>% 
 select(class, variable, label, description) %>% 
 as_grouped_data(groups = 'class') 

indent_meds_spanner <- 
 which(ft_data$class == "Antihypertensive medication classes")

indent_meds <- 
 which(ft_data$variable %in% bp_med_classes)

ft <- ft_data %>% 
 as_flextable(hide_grouplabel = TRUE,
              col_keys = c('class', 'label', 'description')) %>% 
 set_header_labels(label = "All variables included in module",
                   description = "Variable definition") %>% 
 theme_box() %>% 
 bg(i = ~ !is.na(class), bg = 'grey80') %>%
 bg(i = indent_meds_spanner, bg = 'white') %>%
 italic(i = ~ !is.na(class)) %>%
 padding(i = ~ is.na(class), j = 1, padding.left = 10) %>% 
 padding(i = indent_meds_spanner, j = 1, padding.left = 10) %>% 
 padding(i = indent_meds, j = 1, padding.left = 20) %>% 
 width(j = 1, width = 2) %>%
 width(j = 2, width = 7) %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c("BP",
         "SBP",
         "DBP",
         "JNC7",
         "ACC",
         "AHA",
         "ASCVD",
         "CVD",
         "HbA1c",
         "ACE",
         "NHANES")]
  )
 )

ft

```


\newpage

### Figure S1: Sample size after inclusion and exclusion criteria were applied for the NHANES hypertension application 


```{r}

data.frame(
 check.names = FALSE,
 ` ` = c(
  "Participants",
  "\u2265 18 years old",
  "Completed interview and examination",
  "Had SBP and DBP measurements",
  "Had self-reported information on antihypertensive medication",
  "Final Sample size"
 ),
 Overall = c(107622, 63041, 59799, 56286, 56017, 56017),
 `1999-2000` = c(9965, 5448, 4976, 4755, 4694, 4694),
 `2001-2002` = c(11039, 5993, 5592, 5251, 5181, 5181),
 `2003-2004` = c(10122, 5620, 5303, 4902, 4836, 4836),
 `2005-2006` = c(10348, 5563, 5334, 5028, 5012, 5012),
 `2007-2008` = c(10149, 6228, 5995, 5670, 5664, 5664),
 `2009-2010` = c(10537, 6527, 6360, 6053, 6043, 6043),
 `2011-2012` = c(9756, 5864, 5615, 5436, 5334, 5334),
 `2013-2014` = c(10175, 6113, 5924, 5700, 5692, 5692),
 `2015-2016` = c(9971, 5992, 5735, 5557, 5551, 5551),
 `2017-2020` = c(15560, 9693, 8965, 8024, 8010, 8010)
) %>% 
 flextable() %>% 
 theme_box() %>% 
 add_header_row(values = c("", "NHANES cycle"), colwidths = c(2, 10)) %>% 
 width(width = 0.8) %>% 
 width(j = 1, width = 1) %>% 
 align(align = 'center', part = 'all') %>% 
 align(j = 1, part = 'all') %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c("SBP",
            "DBP",
            "NHANES")]
  )
 )

```

\newpage

### Figure S2: Prevalence of hypertension among US adults with and without chronic kidney disease by calendar year.


```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all',
                 group_variable = 'cc_ckd',
                 geom = 'bar') %>% 
 fig_print()

```
`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

\newpage

### Figure S3: Distribution of blood pressure categories among pregnant women.

A. In 2017-2020 `r single_par`
```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_cat_meds_excluded',
                 time_values = 'most_recent',
                 subset_calls = list("demo_pregnant" = "Yes"),
                 geom = 'bar') %>% 
 fig_print()

```
The `r paste("--")` symbol indicates that an estimate is not reliable. `r single_par`

2.26 represents the estimated proportion of pregnant women with systolic blood pressure of 130 to < 140 mm Hg or diastolic blood pressure of 80 to < 90 mm Hg. `r single_par`

`r footer_hover(parenthetical = "estimated prevalence, upper and lower limits of the 95% confidence interval, or reasons for the suppression of data if applicable", hover_over = "the bars")` `r single_par`

There were no pregnant women in the two highest blood pressure categories, so the figure does not include segments for these categories. `r single_par`

\newpage

B. In 2009-2010 through 2017-2020 `r single_par`
```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_cat_meds_excluded',
                 time_values = 'last_5',
                 pool = TRUE,
                 subset_calls = list("demo_pregnant" = "Yes"),
                 geom = 'bar') %>% 
 fig_print()

```
`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

The estimate for systolic blood pressure of 140 to < 160 or diastolic blood pressure of 90 to < 100 mm Hg is 1.1%. This can be seen on the application by hovering over the red bar with your mouse. `r single_par`

\newpage

### Figure S4: Age-adjusted prevalence of resistant hypertension by calendar year.

A. Among non-pregnant US adults who self report taking antihypertensive medication and are taking 1 or more antihypertensive medication classes `r single_par`
```{r, fig.height=3.75}

p1 <- nhanes_visualize(
 data = nhanes_data,
 key = nhanes_key,
 outcome_variable = 'htn_resistant_accaha',
 subset_calls = list(
  "demo_pregnant" = c("No", "Missing"),
  "bp_med_use" = "Yes",
  "bp_med_n_class" = c('One', 'Two', 'Three', 'Four or more')
 ),
 time_values = 'all', 
 geom = 'bar'
)

p2 <- nhanes_visualize(
 data = nhanes_data,
 key = nhanes_key,
 outcome_variable = 'htn_resistant_accaha',
 subset_calls = list(
  "demo_pregnant" = c("No", "Missing"),
  "bp_med_use" = "Yes",
  "bp_med_n_class" = c('Three', 'Four or more')
 ),
 time_values = 'all', 
 geom = 'bar'
)

fig_print(p1)

```
Age adjustment was performed through direct standardization, using the estimated age distribution of US adults with hypertension from 1999 to 2020 as the standard (26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥ 75 years of age, respectively) `r single_par`

`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

Survey participants with missing values for pregnancy status were assumed to be non-pregnant `r single_par`

\newpage

B. Among non-pregnant US adults who self report taking antihypertensive medication and are taking 3 or more antihypertensive medication classes `r single_par`
```{r, fig.height=3.75}
fig_print(p2)
```
Age adjustment was performed through direct standardization, using the estimated age distribution of US adults with hypertension from 1999 to 2020 as the standard (26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥ 75 years of age, respectively) `r single_par`

`r footer_hover(parenthetical = "estimated prevalence and the upper and lower limits of the 95% confidence interval", hover_over = "the bars")` `r single_par`

Survey participants with missing values for pregnancy status were assumed to be non-pregnant `r single_par`

\newpage

```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "landscape"),
    page_margins = page_mar(bottom = 1/8, top = 1/8, 
                            right = 1/4, left = 1/4),
    type = "continuous"
  )
)
```

