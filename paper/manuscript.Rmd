---
title: "Hypertension statistics for US adults: an open-source web application for analysis and visualization of US NHANES data"
always_allow_html: true
output: 
  officedown::rdocx_document:
    reference_docx: style_manuscript_times_new_roman.docx
    keep_md: true
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
 echo = FALSE,
 message = FALSE,
 warning = FALSE,
 fig.width = 10.5,
 fig.height = 4, 
 dpi = 300,
 ft.keepnext = FALSE
)

suppressPackageStartupMessages({
 library(officer)
 library(cardioStatsUSA)
 library(magrittr)
 library(gtsummary)
 library(tidyverse)
 library(survey)
 library(flextable)
 library(plotly)
})

conflicted::conflict_prefer('as_flextable', 'flextable')
conflicted::conflict_prefer('filter', 'dplyr')
conflicted::conflict_prefer('layout', 'plotly')

# define age weights for standardization
standard_weights_overall <- c(49.3, 33.6, 10.1, 7)
standard_weights_htn <- c(26.4, 43.5, 17.0, 13.2)

# default is double space 
# single spacing for title page, abstract, captions
single_par <- fp_par(line_spacing=1)


abbrvs <- list(
  "CI"   = 'confidence interval',
  "BP"   = "blood pressure",
  "SBP"  = "systolic blood pressure",
  "DBP"  = "diastolic blood pressure",
  "SD"   = 'standard deviation',
  "IQR"  = 'interquartile range',
  "JNC7" = "Seventh Joint National Committee",
  "ACC"  = "American College of Cardiology",
  "AHA"  = "American Heart Association",
  "CVD"  = 'cardiovascular disease'
)

abbrvs_paste <- function(strings){
  
  front <- 'Abbreviations'
  
  matter <- glue::glue_collapse(strings, sep = '; ', last = '; and ')
  
  paste(front, matter, sep = ': ')
  
}

abbrvs_write <- function(abbr){
  
  sorted <- abbr[sort(names(abbr))]
  
  strings <- map2_chr(names(sorted), sorted, paste, sep = ' = ')
  
  abbrvs_paste(strings)
  
}


```

Byron C. Jaeger, PhD,^1^ 
Ligong Chen, PhD,^2^
Adam P. Bress, PharmD, MS,^3,4^ 
Kathryn Foti,^2^
Shakia T. Hardy,^2^
Bharat Poudel, MSPH,^2^
Ashley Christenson, BS,^2^ 
Lisandro D. Colantonio, PhD,^2^
Paul Muntner, PhD,^2^


^1^Department of Biostatistics and Data Science, Wake Forest School of Medicine, Winston-Salem, NC. `r single_par`
^2^Department of Epidemiology, University of Alabama at Birmingham. `r single_par`
^3^Informatics, Decision-Enhancement, and Analytic Sciences (IDEAS) Center, Veterans Affairs, Salt Lake City Health Care System, Salt Lake City, UT. `r single_par`
^4^Department of Population Health Sciences, University of Utah School of Medicine, Salt Lake City, UT. `r single_par`

\newpage

# ABSTRACT

<!-- Abstract: Structured with the following headings and no more than 250 words: Background, Objectives, Methods, Results, Conclusions. The abstract should present essential data in 5 paragraphs. Use complete sentences. All data in the abstract also must appear in the manuscript text or tables. -->

**Background**: Data from the US National Health and Nutrition Examination Survey (NHANES) are freely available and can be analyzed to produce hypertension statistics for the non-institutionalized US population. However, the analysis of these data requires statistical programming knowledge.

**Methods**: We developed and validated a web-based application that provides hypertension statistics for US adults using 10 cycles of NHANES data, 1999-2000 through 2017-2020, without requiring users to conduct statistical programming. The application’s interface allows users to estimate crude and age-adjusted means, quantiles, and proportions. Population counts can also be estimated. To demonstrate the application’s capabilities, we estimated hypertension statistics for US adults.

**Results**: The estimated mean systolic blood pressure (BP) declined from 123 mmHg in 1999-2000 to 120 mmHg in 2009-2010 and increased to 123 mmHg in 2017-2020. The age-adjusted prevalence of hypertension (i.e., systolic BP ≥130 mmHg, diastolic BP ≥80 mmHg or self-reported antihypertensive medication use) was 47.9% in 1999-2000, 43.0% in 2009-2010, and 44.7% in 2017-2020. In 2017-2020, 115.3 million US adults had hypertension. The age-adjusted prevalence of controlled BP, defined according to the 2017 American College of Cardiology/American Heart Association BP guideline, among US adults with hypertension was 9.6% in 1999-2000, 24.6% in 2013-2014, and 21.7% in 2017-2020. After age-adjustment and among US adults who self-reported taking antihypertensive medication, 27.4%, 48.5%, and 42.8% had controlled BP in 1999-2000, 2013-2014, and 2017-2020, respectively. The application was validated by replicating statistics from three publications.

**Conclusions**: The application developed and validated in the current study produced valid, transparent, and reproducible results and is publicly available.

\newpage

The National Health and Nutrition Examination Survey (NHANES) is a program conducted by the US National Center for Health Statistics (NCHS) of the Centers for Disease Control and Prevention (CDC) and is designed to assess the ongoing health and nutritional status of the non-institutionalized US population. NHANES data have been analyzed to provide hypertension statistics for non-institutionalized US adults with important policy and public health implications. For example, NHANES data have been used to estimate the impact of the lower blood pressure (BP) levels that define hypertension and controlled BP in the 2017 American College of Cardiology/American Heart Association (ACC/AHA) BP guideline versus the Seventh Report of the Joint National Committee on Prevention, Detection, Evaluation, and Treatment of High BP (JNC7) guideline. Additionally, NHANES data have been used to track the proportion of US adults with hypertension that have controlled BP, which were included in a Call-to-Action to Control BP from the US Surgeon General.

NHANES data are publicly available and accessible through the CDC website. However, analyzing NHANES data may be challenging for a number of reasons. Specific statistical techniques are required to account for the multi-stage sampling design used to select NHANES participants and analyses need to be weighted to produce nationally representative estimates. NHANES data are currently collected in two-year periods, referred to as cycles, and each cycle  includes over 50 data files and accompanying informational material.  NHANES data collection protocols have changed over time for some variables, and these differences should be taken into account when comparing or aggregating data from multiple cycles. Also, tests need to be performed to ensure the statistical estimates are reliable, and unstable estimates should be suppressed.

We developed an open-source web-based application that provides nationally representative BP and hypertension statistics for non-institutionalized US adults using NHANES data without requiring users to conduct statistical programming. The goal of the application is to increase the use of NHANES data for research and policy decision making with a focus on ensuring results are valid, transparent, and reproducible. In this manuscript, we review the design, development and validation of the application, present BP and hypertension statistics for US adults, and describe online tutorials and resources that may help users engage with the application.

# METHODS

The NHANES program was initiated in the early 1960s and beginning in 1999 has been conducted continuously, in two-year cycles. In each cycle, potential participants were identified using a multi-stage sampling process. The protocols for each cycle were approved by the NCHS Institutional Review Board. Written informed consent was obtained from each participant.

NHANES data were collected through in-home interviews and study examinations conducted at mobile examination centers. The interview included questions about demographics, health behaviors, medical history, and medication use. During the interview, the labels of medications that participants reported taking in the preceding 30 days were recorded. During the study examination, height, weight and BP were measured and blood and spot urine samples were collected. Of relevance to the application, blood samples were used to measure total and HDL cholesterol, glycated hemoglobin and serum creatinine, and the urine sample was used to measure albumin and creatinine and to conduct a pregnancy test. The protocol for obtaining BP measurements is available online. In brief, systolic and diastolic BP (SBP and DBP, respectively) were measured three times by trained and certified physicians. BP was measured using a mercury sphygmomanometer from 1999-2000 through 2015-2016 and using an oscillometric device in 2017-2020. The mean SBP and DBP levels were computed over all available measurements for each participant. The oscillometric SBP and DBP values were calibrated to the mercury device. Antihypertensive medication classes were defined using those listed in the 2017 ACC/AHA BP guideline. For the current analysis, we defined hypertension, BP control, and resistant hypertension according to the 2017 ACC/AHA BP guideline. The application also has these variables defined according to the JNC7 definitions. A complete list of the variables available in the data set is provided in **Table 1** with full definitions provided in **Table S1**.

There were 107,622 NHANES participants in the 10 cycles from 1999-2000 to 2017-2020. We restricted the dataset to adults ≥ 18 years of age. This exclusion was applied because statistics for BP levels and hypertension in children and adolescents are markedly different than for adults. We further restricted the population to participants who completed the in-home interview and study examination, with one or more SBP and DBP measurement, and who had data on self-reported antihypertensive medication use. After these exclusions were applied, the population in this application included 56,035 participants (**Figure S1**).

## Features of the web application

A full summary of this application’s features and associated tutorials are available online. Briefly, users can select NHANES cycles from 1999-2000 to 2017-2020 to be analyzed. Estimates are weighted to represent the non-institutionalized US population and users may incorporate age-adjustment through direct standardization. Users can restrict analyses to subsets of participants (e.g., participants who self-reported taking antihypertensive medication). When population count estimates are requested, survey weights are calibrated to account for missing information on SBP, DBP or self-reported antihypertensive medication use. Users may tabulate or visualize summaries, and can present results for the overall population or in subgroups defined by a stratifying variable. All figures and datasets created with the web application can be downloaded and saved. Following CDC recommendations, unreliable statistical estimates are automatically suppressed. To increase precision and reliability of estimates, contiguous NHANES cycles can be combined.

## Development and validation of the web application

The web application was created using Shiny, an open-source software package that translates code from the R programming language into HTML, CSS, or JavaScript commands that create a website interface. We created the “cardioStatsUSA” R package to provide additional details on the web application’s design and comprehensive documentation of its components. We validated the web application by using it to reproduce statistics reported in two prior studies and one CDC report.

## Statistical analysis

We performed statistical analyses to demonstrate core features of the application. We estimated the mean SBP for US adults by NHANES cycle, 1999-2000 through 2017-2020, with points showing the estimated means and error bars showing the 95% confidence intervals. We made bar charts presenting the age-adjusted prevalence of hypertension and the estimated number of US adults with hypertension. For age adjustment, we used the estimated age distribution of US adults from 1999 to 2020 as the standard (49.3%, 33.6%, 10.1% and 7.0% being 18 to 44, 45 to 64, 65 to 74 and ≥75 years of age, respectively). To illustrate how results from the application appear when saved in various formats (e.g., comma separated, portable document format, Microsoft Excel), we tabulated the estimated race/ethnicity distribution of US adults with and without hypertension, separately. We demonstrated stratification by estimating the prevalence of hypertension by NHANES cycle for US adults with and without chronic kidney disease (CKD). We showed the application’s ability to suppress output when statistical estimates are unstable by attempting to estimate the distribution of BP categories (SBP/DBP < 120/80 mm Hg, 120-129/<80 mm Hg, 130-139/80-89 mm Hg, 140-159/90-99 mm Hg and ≥ 160/100 mm Hg) among pregnant women in 2017-2020. We then showed that reliable estimates can be obtained for the distribution of BP categories among pregnant women by pooling NHANES cycles from 2009-2010 through 2017-2020.

We also illustrated how core features of the application can be combined to perform customized analyses. Specifically, we estimated the age-adjusted proportion of US adults with controlled BP by NHANES cycle among non-pregnant US adults with hypertension, overall and among those who self-reported taking antihypertensive medication. We also estimated the age-adjusted prevalence of resistant hypertension by NHANES cycle for US adults with hypertension taking antihypertensive medication and among US adults with hypertension taking ≥ 3 classes of antihypertensive medication. For age adjustment in the analysis of resistant hypertension, we set the age distribution for the standard population to represent US adults with hypertension from 1999 to 2020: 26.4%, 43.4%, 17.0% and 13.2% being 18 to 44 years, 45 to 64, 65 to 74, and ≥75 years of age, respectively.


# RESULTS

Among non-institutionalized US adults ≥ 18 years of age, the estimated mean SBP was 123 (95% CI 121, 124) mm Hg in 1999-2000, 120 (95% CI 120, 121) mm Hg in 2009-2010 and 123 (95% CI 122, 124) mm Hg in 2017-2020 (**Figure 1**).  The age-adjusted prevalence of hypertension was highest in 1999-2000 (47.9%), lowest in 2009-2010 (43.0%), and 44.7% in 2017-2020 (**Figure 2**). In 1999-2000, there were an estimated 89.8 million US adults with hypertension (**Figure 3**). The number of US adults with hypertension increased to 115.3 million in 2017-2020.  In each NHANES cycle, the estimated prevalence of hypertension was higher among US adults with versus without CKD (**Figure S2**). In 2017-2020, a higher percentage of US adults with versus without hypertension were non-Hispanic Black (13.5% versus 9.3%) while a lower percentage of US adults with versus without hypertension were Hispanic (12.3% versus 18.1%) (**Table 2**). Among pregnant women, the distribution of BP categories could not be estimated reliably in 2017-2020 (**Figure S3; Panel A**) except for the group with SBP of 130 to < 140 mm Hg or DBP of 80 to < 90 mm Hg, but was stable for all groups after pooling NHANES cycles from 2009-2010 through 2017-2020 (**Figure S3; Panel B**)

The age-adjusted prevalence of BP control among US adults with hypertension was lowest in 1999-2000 (9.6%), highest in 2013-2014 (24.6%), and 21.7% in 2017-2020 (**Figure 4; panel A**). Among US adults who self-reported taking antihypertensive medication, 27.4%, 48.5%, and 42.8% had controlled BP in 1999-2000, 2013-2014, and 2017-2020, respectively (**Figure 4; panel B**). The age-adjusted prevalence of resistant hypertension among US adults who self-reported taking antihypertensive medication was lowest in 1999-2000 (13.7%), highest in 2005-2006 (20.4), and 16.2% in 2017-2020 (**Figure S4; panel A**). Among US adults who were taking three or more classes of antihypertensive medication, the prevalence of resistant hypertension was lowest in 2009-2010 (64.1%), highest in 2003-2004 (78.3%), and 67.9% in 2017-2020 (**Figure S4; panel B**).

<!-- Among US adults with hypertension, 61.5% were not taking antihypertensive medication in 1999-2000 compared with 44.6% not taking antihypertensive medication in 2017-2020. (Figure 4; panel A). Among US adults who self-reported taking antihypertensive medication, the percentage taking four or more classes of antihypertensive medication increased from 3.5% in 1999-2000 to 7.6% in 2017-2020 (Figure 4; panel B).  -->

# DISCUSSION

In the current manuscript, we present a web application that allows the calculation of nationally representative estimates for BP, hypertension and antihypertensive medication-related outcomes using publicly available NHANES data. Using this application, we generated crude and age-adjusted BP and hypertension statistics. Also, we generated statistics stratified by characteristics of US adults and pooling multiple NHANES cycles to obtain more precise estimates when working with the small sub-group of pregnant women. Following its validation, version 0.0.1 of the application was released and deployed in a publicly available server on **DATE TBD**.(add a citation to version 0.0.1 of the cardioStatsUSA package and a citation to the url where the shiny app lives) Researchers, clinicians, and the public can use the application to generate customized BP and hypertension statistics for US adults.


NHANES was designed to obtain nationally representative estimates of the health and nutrition status of non-institutionalized US adults and is an ideal data source to obtain statistics related to hypertension. SBP and DBP were measured following a standardized protocol by trained and certified staff.  NHANES data are publicly available to download but working with these data requires understanding variable definitions and advanced programming and statistical knowledge. Challenges that users encounter when analyzing with NHANES include the need to download and merge multiple data files, even for a single NHANES cycle; combining multiple variables to create outcome definitions, which may require dealing with missing data and questionnaire skip patterns; harmonizing definitions across multiple NHANES cycles; and the analyses of complex survey design data. The web application that we present in the current manuscript was designed to reduce barriers to using NHANES so that these data can more fully inform public health decisions and future research related to hypertension.

Several design decisions have been incorporated into the application. We required participants to have a single SBP and DBP to be included while some prior analyses required three SBP and DBP measurements.  We chose an approach that is consistent with several analyses conducted by CDC investigators (cite pmid 26633197, 29155682). However, mean BP and the prevalence of high BP would be lower if we required multiple BP measurements (cite pmid 23126346). Any bias resulting from this decision is likely to be small as over 95% of adult NHANES participants with at least one SBP and DBP measurement had three SBP and DBP measurements. The application re-calibrates the NHANES weights for the estimation of population counts (cite pmid 12500213). This was done because participants missing data on SBP, DBP or antihypertensive medication use cannot have BP or hypertension-related outcomes. Weights were not re-calibrated when estimating proportions as participants missing data are removed from the numerator and denominator. Medication classes were coded using generic names and the drug classes in the 2017 ACC/AHA BP guideline. We recognize the NCHS recommends using Lexicon Plus®, a proprietary database, to categorize medication classes. While the categorization of most medications is identical using generic drug names and Lexicon Plus®, some differences exist. Many additional decisions were made regarding the definitions of variables, inclusion of study participants, and analytic approach. We sought to make decisions that would be widely acceptable and transparent to ensure the results could be described accurately.

We were able to replicate several prior manuscripts using the application. However, we were not able to replicate some results. For example, a prior manuscript reported the prevalence of resistant hypertension defined by the 2017 ACC/AHA BP guideline to be 19.7% in 2009-2014(cite pmid 30580690). When estimated by the application, the prevalence of resistant hypertension over this time period was 17.1%. The difference in the prevalence estimates can be attributed to the approach used to categorize medication into classes. The prior publication used Lexicon Plus®, which counted spironolactone as two drug classes, a potassium-sparing diuretic and an aldosterone antagonist. We included spironolactone as a single drug class, an aldosterone antagonist. Additionally, Lexicon Plus® includes Sotalol as a beta blocker and nitroglycerine as a direct vasodilator and we did not include these drugs as antihypertensive medications as they are not listed in the 2017 ACC/AHA BP guideline. The differences in results between the application and this previously published manuscript emphasize that it may not be possible to always generate results that are identical to prior publications. Users should be aware of the choices made in defining variables as this may affect the statistical estimates generated using the application.

The application has a number of features that can be used in combination to create highly customized statistics. Variables can be analyzed as outcomes or used to stratify results or restrict analyses to subsets of participants.  Combining the variables, tens of thousands of unique statistics can be estimated. In addition, users can generate statistics for US adults over 22 years, pooling results or stratifying the data. All results from the application can be saved as an image and included in scientific proposals or presentations. In addition, the ability to download summary data from the application allows users to further customize their results in tabular or graphical formats. The web application can also be used for educational purposes, as teachers can use it to analyze health outcomes for US adults interactively with students.

With an open-source software license and publicly available documentation and data, the web application we developed can be extended. The current manuscript described a set of hypertension variables and a sub-population of NHANES participants with data on BP and antihypertensive medication use. The application’s interface and its supporting R package allows additional variables to be added. In addition, the application may be extended to include data from additional NHANES cycles as they become available.  

## Strengths/limitations

This study has a number of strengths. We used NHANES data, which are publicly available, rigorously collected, and allow for estimation of nationally representative statistics. Also, we leveraged open-source software to ensure that our application is transparent, able to be extended, and freely available. This study also has several limitations. First, NHANES participants had their mean BP measured during a single visit, and BP guidelines recommend obtaining mean BP using at least two BP values measured on separate days. Second, the response rate for NHANES has declined from 1999-2000 through 2017-2020. Effects of this decline are unclear.

## Conclusions

We developed a web-based application for analysis of hypertension outcomes among non-institutionalized adults living in the US from 1999-2000 through 2017-2020. The application is publicly available and produces valid, transparent, and reproducible results.

\newpage

### Table 1: Blood pressure, hypertension and antihypertensive medication variables that may be analyzed using the web application.

```{r}

bp_med_classes <- c(
 "bp_med_ace",
 "bp_med_aldo",
 "bp_med_alpha",
 "bp_med_angioten",
 "bp_med_beta",
 "bp_med_central",
 "bp_med_ccb",
 "bp_med_diur_Ksparing",
 "bp_med_diur_loop",
 "bp_med_diur_thz",
 "bp_med_renin_inhibitors",
 "bp_med_vasod"
)

classes <- c("Blood pressure",
             "Hypertension", 
             "Antihypertensive medication")

ft_data <- nhanes_key %>% 
 .[module == 'htn'] %>% 
 .[class %in% classes] %>% 
 .[, class := factor(class, levels = classes)] %>% 
 .[order(class)] %>% 
 .[variable %in% bp_med_classes,
   class := "Antihypertensive medication classes"] %>% 
 select(class, variable, label) %>% 
 as_grouped_data(groups = 'class') 

indent_meds_spanner <- 
 which(ft_data$class == "Antihypertensive medication classes")
indent_meds <- 
 which(ft_data$variable %in% bp_med_classes)

ft <- ft_data %>% 
 as_flextable(hide_grouplabel = TRUE,
              col_keys = c('class', 'label')) %>% 
 set_header_labels(label = "Variable") %>% 
 theme_box() %>% 
 bg(i = ~ !is.na(class), bg = 'grey80') %>%
 bg(i = indent_meds_spanner, bg = 'white') %>%
 italic(i = ~ !is.na(class)) %>%
 padding(i = ~ is.na(class), padding.left = 10) %>% 
 padding(i = indent_meds_spanner, padding.left = 10) %>% 
 padding(i = indent_meds, padding.left = 20) %>% 
 width(j = 1, width = 6) %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c('BP', 'SBP', 'DBP', 'ACC', 'AHA', 'JNC7')]
  )
 )

ft

```


```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "portrait"),
    type = "continuous"
  )
)
```


<!-- TODO: make this identical to website output, including even the unreliability columns. Add footnotes to explain what column names mean -->

### Table 2:	Race/ethnicity distribution of US adults with and without hypertension in 2017-2020

```{r}

library(table.glue)

rspec <- round_spec() %>% 
 round_using_decimal(digits = 1)

nhanes_data %>% 
 nhanes_summarize(key = nhanes_key,
                  outcome_variable = 'demo_race',
                  group_variable = 'htn_accaha',
                  time_values = 'most_recent') %>%
 mutate(
  across(where(is.numeric), 
         .fns = table_value, 
         rspec = rspec)
 ) %>% 
 filter(statistic == 'percentage') %>% 
 select(-statistic, 
        -ends_with("reason"),
        -unreliable_status,
        -review_needed) %>% 
 flextable() %>% 
 set_header_labels(
  svy_year = 'NHANES cycle',
  htn_accaha = 'Hypertension',
  demo_race = 'Race/Ethnicity',
  estimate = 'Estimate',
  std_error = 'Standard error',
  ci_lower = 'CI lower',
  ci_upper = 'CI upper',
  n_obs = 'N observations'
 ) %>% 
 theme_box() %>% 
 width(width = 1) %>% 
 align(align = 'center', part = 'all') %>% 
 align(j = 1, align = 'center', part = 'all')

```

\newpage

### Figure 1 Mean systolic blood pressure for US adults by calendar year

```{r, fig.height=3.75}

fig_print <- function(x){
 x[[1]] %>% 
  layout(font = list(size = 40))
}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_sys_mean',
                       time_values = 'all', 
                       geom = 'points',
                       size_point = 25,
                       size_error = 1)

fig_print(p1)

```
Dots represent mean systolic blood pressure. Vertical lines represent the 95% confidence interval.

\newpage


### Figure 2 Age-adjusted prevalence of hypertension for US adults by calendar year

```{r, fig.height=3.75}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all', 
                 standard_weights = standard_weights_overall, 
                 geom = 'bar') %>% 
 fig_print()

```
Age adjustment was performed through direct standardization

\newpage

### Figure 3 Number of US adults with hypertension

```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all',
                 statistic_primary = 'count',
                 geom = 'bar') %>% 
 fig_print()

```

\newpage


### Figure 4 Age-adjusted prevalence of blood pressure control by calendar year.

A. Among those with hypertension
```{r, fig.height=3.75}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_control_accaha',
                       subset_calls = list("htn_accaha" = "Yes"),
                       standard_weights = standard_weights_htn,
                       time_values = 'all', 
                       geom = 'bar')

p2 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'bp_control_accaha',
                       subset_calls = list("htn_accaha" = "Yes",
                                           "bp_med_use" = "Yes"),
                       standard_weights = standard_weights_htn,
                       time_values = 'all', 
                       geom = 'bar')



fig_print(p1)

```

B. Among those who self-report taking antihypertensive medication 
```{r, fig.height=3.75}
fig_print(p2)
```
Age adjustment was performed through direct standardization

<!-- \newpage -->

<!-- **Figure 4** Distribution of the number of antihypertensive medication classes being taken among those with hypertension by calendar period -->

<!-- A. Among those with hypertension -->
<!-- ```{r, fig.height=3.75} -->

<!-- p1 <- nhanes_visualize(data = nhanes_data, -->
<!--                        key = nhanes_key, -->
<!--                        outcome_variable = 'bp_med_n_class', -->
<!--                        subset_calls = list("htn_accaha" = "Yes"), -->
<!--                        time_values = 'all', -->
<!--                        geom = 'bar') -->

<!-- p2 <- nhanes_visualize(data = nhanes_data, -->
<!--                        key = nhanes_key, -->
<!--                        outcome_variable = 'bp_med_n_class', -->
<!--                        subset_calls = list("htn_accaha" = "Yes", -->
<!--                                            "bp_med_use" = "Yes"), -->
<!--                        time_values = 'all', -->
<!--                        geom = 'bar') -->

<!-- fig_print(p1) -->

<!-- ``` -->

<!-- B. Among those with hypertension who self-report taking antihypertensive medication -->
<!-- ```{r, fig.height=3.75} -->
<!-- fig_print(p2) -->
<!-- ``` -->

\newpage

### Table S1: All variables included in the web-based application.

```{r}

classes <-
 c("Survey",
   "Demographics",
   "Blood pressure",
   "Hypertension",
   "Antihypertensive medication",
   "Comorbidities")

ft_data <- nhanes_key %>% 
 .[class %in% classes] %>%
 .[variable != 'svy_subpop_chol'] %>% 
 .[, class := factor(class, levels = classes)] %>% 
 .[order(class)] %>% 
 .[variable %in% bp_med_classes,
   class := "Antihypertensive medication classes"] %>% 
 select(class, variable, label, description) %>% 
 as_grouped_data(groups = 'class') 

indent_meds_spanner <- 
 which(ft_data$class == "Antihypertensive medication classes")

indent_meds <- 
 which(ft_data$variable %in% bp_med_classes)

ft <- ft_data %>% 
 as_flextable(hide_grouplabel = TRUE,
              col_keys = c('class', 'label', 'description')) %>% 
 set_header_labels(label = "All variables included in module",
                   description = "Variable definition") %>% 
 theme_box() %>% 
 bg(i = ~ !is.na(class), bg = 'grey80') %>%
 bg(i = indent_meds_spanner, bg = 'white') %>%
 italic(i = ~ !is.na(class)) %>%
 padding(i = ~ is.na(class), j = 1, padding.left = 10) %>% 
 padding(i = indent_meds_spanner, j = 1, padding.left = 10) %>% 
 padding(i = indent_meds, j = 1, padding.left = 20) %>% 
 width(j = 1, width = 2) %>%
 width(j = 2, width = 7) %>% 
 add_footer_lines(
  values = abbrvs_write(
   abbrvs[c('BP', 'SBP', 'DBP', 'ACC', 'AHA', 'JNC7')]
  )
 )

ft

```


\newpage

### Figure S1 Application of inclusion and exclusion criteria for the application of NHANES hypertension data.

```{r}

data.frame(
 check.names = FALSE,
 ` ` = c(
  "Participants",
  "\u2265 18 years old",
  "Completed interview and examination",
  "Had SBP and DBP measurements",
  "Had self-reported information on antihypertensive medication",
  "Final Sample size"
 ),
 Overall = c(107622, 63041, 59799, 56286, 56035, 56035),
 `1999-2000` = c(9965, 5448, 4976, 4755, 4694,   4694),
 `2001-2002` = c(11039, 5993, 5592, 5251, 5184,  5184),
 `2003-2004` = c(10122, 5620, 5303, 4902, 4838,  4838),
 `2005-2006` = c(10348, 5563, 5334, 5028, 5015,  5015),
 `2007-2008` = c(10149, 6228, 5995, 5670, 5665,  5665),
 `2009-2010` = c(10537, 6527, 6360, 6053, 6043,  6043),
 `2011-2012` = c(9756, 5864, 5615, 5436, 5337,   5337),
 `2013-2014` = c(10175, 6113, 5924, 5700, 5694,  5694),
 `2015-2016` = c(9971, 5992, 5735, 5557, 5552,   5552),
 `2017-2020` = c(15560, 9693, 8965, 8024, 8013,  8013)
) %>% 
 flextable() %>% 
 theme_box() %>% 
 add_header_row(values = c("", "NHANES cycle"), colwidths = c(2, 10)) %>% 
 width(width = 0.8) %>% 
 width(j = 1, width = 1) %>% 
 align(align = 'center', part = 'all') %>% 
 align(j = 1, part = 'all')

```

\newpage

### Figure S2: Prevalence of hypertension among US adults with and without chronic kidney disease

```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'htn_accaha',
                 time_values = 'all',
                 group_variable = 'cc_ckd',
                 geom = 'bar') %>% 
 fig_print()

```

\newpage

### Figure S3: Distribution of blood pressure categories among pregnant women.

A. In 2017-2020
```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_cat_meds_excluded',
                 time_values = 'most_recent',
                 subset_calls = list("demo_pregnant" = "Yes"),
                 geom = 'bar') %>% 
 fig_print()

```

B. In 2009-2010 through 2017-2020
```{r}

nhanes_visualize(data = nhanes_data,
                 key = nhanes_key,
                 outcome_variable = 'bp_cat_meds_excluded',
                 time_values = 'last_5',
                 pool = TRUE,
                 subset_calls = list("demo_pregnant" = "Yes"),
                 geom = 'bar') %>% 
 fig_print()

```


\newpage

### Figure S4: Age-adjusted prevalence of resistant hypertension by calendar year.

A. Among those who self report taking antihypertensive medication 
```{r, fig.height=3.75}

p1 <- nhanes_visualize(data = nhanes_data,
                       key = nhanes_key,
                       outcome_variable = 'htn_resistant_accaha',
                       subset_calls = list("bp_med_use" = "Yes"),
                       time_values = 'all', 
                       geom = 'bar')

p2 <- nhanes_visualize(
 data = nhanes_data,
 key = nhanes_key,
 outcome_variable = 'htn_resistant_accaha',
 subset_calls = list("bp_med_use" = "Yes",
                     "bp_med_n_class" = c('Three', 'Four or more')),
 time_values = 'all', 
 geom = 'bar'
)

fig_print(p1)

```

B. Among those who self report taking antihypertensive medication and are taking 3 or more classes.
```{r, fig.height=3.75}
fig_print(p2)
```
Age adjustment was performed through direct standardization

\newpage




<!-- **Figure S5** Prevalence of hypertension by age categories in 2017-2020 -->

<!-- ```{r} -->
<!-- nhanes_visualize(data = nhanes_data, -->
<!--                  key = nhanes_key, -->
<!--                  outcome_variable = 'htn_accaha', -->
<!--                  group_variable =  'demo_age_cat', -->
<!--                  time_values = 'most_recent', -->
<!--                  geom = 'bar') %>%  -->
<!--  fig_print() -->
<!-- ``` -->
<!-- \newpage -->

<!-- **Figure S6** Prevalence of hypertension by sex in 2017-2020 -->

<!-- ```{r} -->
<!-- nhanes_visualize(data = nhanes_data, -->
<!--                  key = nhanes_key, -->
<!--                  outcome_variable = 'htn_accaha', -->
<!--                  group_variable = 'demo_gender', -->
<!--                  time_values = 'most_recent', -->
<!--                  geom = 'bar') %>%  -->
<!--  fig_print() -->
<!-- ``` -->

<!-- \newpage -->

<!-- **Figure S7** Prevalence of hypertension by race/ethnicity in 2017-2020 -->

<!-- ```{r} -->
<!-- nhanes_visualize(data = nhanes_data, -->
<!--                  key = nhanes_key, -->
<!--                  outcome_variable = 'htn_accaha', -->
<!--                  group_variable = 'demo_race', -->
<!--                  time_values = 'most_recent', -->
<!--                  geom = 'bar') %>%  -->
<!--  fig_print() -->
<!-- ``` -->

<!-- \newpage -->

<!-- **Figure S8** Prevalence of uncontrolled blood pressure among pregnant women from 2011-2012 through 2017-2020. -->

<!-- ```{r} -->

<!-- nhanes_visualize(data = nhanes_data, -->
<!--                  key = nhanes_key, -->
<!--                  outcome_variable = 'bp_cat_meds_excluded', -->
<!--                  time_values = c("last_5"), -->
<!--                  pool = TRUE, -->
<!--                  subset_calls = list("demo_pregnant" = "Yes"), -->
<!--                  geom = 'bar') %>%  -->
<!--  fig_print() -->

<!-- ``` -->

```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "landscape"),
    page_margins = page_mar(bottom = 1/8, top = 1/8, 
                            right = 1/4, left = 1/4),
    type = "continuous"
  )
)
```

