---
title: "Tables and Figures"
always_allow_html: true
output: 
  officedown::rdocx_document:
    keep_md: true
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
 echo = FALSE,
 message = FALSE,
 warning = FALSE,
 fig.width = 7,
 fig.height = 4, 
 dpi = 300
)

suppressPackageStartupMessages({
 library(officer)
 library(cardioStatsUSA)
 library(magrittr)
 library(gtsummary)
 library(tidyverse)
 library(survey)
 library(flextable)
 library(plotly)
})

```

**INTRODUCTION**

The National Health and Nutrition Examination Survey (NHANES) is a program conducted by the US National Center for Health Statistics (NCHS) of the Centers for Disease Control and Prevention (CDC) and is designed to assess the health and nutritional status of the US population. The NHANES program was initiated in the early 1960s and beginning in 1999 has been conducted continuously, in two-year cycles.  NHANES includes participant interviews and physical examinations, each conducted following rigorous protocols. The NHANES interview includes questions about prior diagnoses of hypertension and self-reported antihypertensive medication use and a medication inventory where containers for prescription medications are reviewed and recorded.  The physical examination includes blood pressure (BP) measurements by trained and certified physicians. 

NHANES data have been used to provide estimates of the proportion of US adults with hypertension, aware they had hypertension, taking antihypertensive medication and with controlled BP.  These data have been informative for public health, informing policy making, identifying gaps in guideline-recommended care and for scientific discovery.  The 2017 American College of Cardiology/American Heart Association (ACC/AHA) BP guideline included analyses of NHANES data estimating the percentage of US adults with hypertension based on its updated definition.  Additionally, NHANES data have been used to track the proportion of US adults with controlled BP, which were included in a Call-to-Action to Control BP from the US Surgeon General. 

NHANES data are publically available and easily accessible through the CDC website. However, there are barriers to analyzing NHANES data.  The NHANES program uses a multi-stage sampling design to select participants for enrollment and NHANES data require specific programming commands to provide valid statistical estimates.  Also, the NHANES protocols are detailed and each two-year NHANES cycle includes over 50 data files, each of which has detailed informational material on the included data.  To address the barriers to analyzing NHANES data, we developed an open-access online platform that allows users to obtain visual and tabular summaries of the NHANES BP and hypertension data.  The goal of this platform is to increase the usage of NHANES data for BP and hypertension research and policy decision making with a focus on ensuring results are valid and transparent.  In this manuscript, we review the design of the platform, we show some results of NHANES analyses using the platform, and we provide a tutorial on how people can use the platform. 


**METHODS**

The open-access online platform that we describe in this manuscript contains data from 10 NHANES cycles – NHANES 1999-2000 through NHANES 2017-2020.  In each NHANES cycle, potential participants are identified using a multi-stage selection process.  First, every county across the US is placed into 1 of 15 groups based on their characteristics. Next, one county is selected from each group. Each of the 15 selected counties are divided into neighborhoods and 20 to 24 neighborhoods are selected and 30 households are chosen from all houses and apartments in the neighborhood.  Within the selected household, a random process is used to select none, some or all members for inclusion in NHANES.  The participation rate in NHANES has declined from 76% of individuals who completed the interview and examination in the 1999-2000 cycle to 47% in the 2017-2020 cycle.     

NHANES data were collected through in-home interviews and study examinations conducted at mobile examination centers. Data elements included on the platform are listed, along with variable definitions, in Supplemental Table 1. Information on age, sex, race/ethnicity, cigarette smoking, a prior diagnosis of diabetes, use of insulin or oral glucose-lowering medication, a prior diagnosis of hypertension, self-reported antihypertensive medication use, history of coronary heart disease, myocardial infarction, stroke, heart failure were obtained by self-report during the in-home interview.  

Details on prescription medications taken in the last 30 days were obtained by a pill bottle review conducted as part of the in-home interview.  Specifically, the labels of medications were reviewed and the complete drug names were recorded into a computer-assisted personal interview system. For the data platform, we categorized antihypertensive medications by class: aldosterone receptor antagonist, α-blocker, angiotensin converting enzyme inhibitor (ACEI), angiotensin receptor blocker (ARB), beta-blocker, calcium channel blocker (CCB), centrally acting agents (e.g., clonidine), direct vasodilator, loop diuretic, potassium sparing diuretic, thiazide diuretic, and renin inhibitor. Data on medication dosages are not available in NHANES.

Following the in-home interview, participants complete a study examination during which height and weight are measured and used to calculate body mass index (BMI). Systolic and diastolic blood pressure
are measured three times, and blood and spot urine samples are collected.  Of relevance to the data platform, the collected blood was used to measure total and HDL cholesterol, glycated hemoglobin and serum creatinine.  The spot urine was used to measure albumin and creatinine.  

The current data platform included participants from NHANES 1999-2000 to 2017-2020 (Figure S1; n=107,622).  As statistics for hypertension and SBP and DBP levels in children and adolescents are markedly different than for adults, we restricted the data in the platform to adults ≥ 18 years of age.  We further restricted the platform to participants who completed the in-home study visit and study examination, with one or more SBP and DBP measurements and who had data on self-reported antihypertensive medication use.  After these exclusions were applied, the data set that we used included 56,035 participants (**Figure S1**).

Statistical analysis
All statistical analyses account for the non-random selection of NHANES participants using survey software in R Version 4.1.3.  Additionally, to provide estimates for the non-institutionalized US population, we applied the NHANES examination weights to all calculations.   For estimating population counts, we recalibrated the weights to account for participants being excluded due to missing information on SBP, DBP or self-reported antihypertensive medication use. The weights were calibrated within age, sex, race/ethnicity and NHANES cycle. 

**RESULTS**

A total of `r sum(nhanes_bp$svy_subpop_htn)` survey participants (mean age 46 years, 52% women, 68% non-Hispanic white) were included in the BP and hypertension cohort (**Table 1**). The estimated prevalence of hypertension was 45.9% (95% CI 43.1, 48.8) in 1999-2000, 43.8% (95% CI 41.1, 46.5) in 2009-2010, and 47.0% (95% CI 44.5, 49.5) in 2017-2020 (**Figure 1**). For US adults in 2017-2020, hypertension was estimated to be more prevalent among older versus younger adults (**Figure S2**), more prevalent among men versus women (**Figure S3**), and more prevalent among adults are non-Hispanic Black versus other race/ethnicity subgroups (**Figure S4**). 

**Self-reported antihypertensive medication use**

Among US adults with hypertension, the estimated percentage who self-reported using antihypertensive medication was 35.0% (95% CI 30.7, 39.7) in 1999-2000, 52.8% (95% CI 48.3, 57.2) in 2009-2010, and 51.3% (95% CI 48.7, 54.0) in 2017-2020 (**Figure 2**). For US adults with hypertension in 2017-2020, adults aged 65 to 74 years had a higher estimated percentage who self-report using antihypertensive medication versus other age groups (**Figure S5**), women had a higher estimated percentage who self-report using antihypertensive medication compared to men (**Figure S6**), and Hispanic adults had a lower estimated percentage who self-report using antihypertensive medication versus other race/ethnicity subgroups (**Figure S7**).

**Classes of antihypertensive medication**

Among US adults with hypertension, the estimated percentage using one or more classes of antihypertensive medication was 38.5% (95% CI 34.5, 42.4) in 1999-2000, 54.3% (95% CI 50.1, 58.5) in 2009-2010, and 55.4% (95% CI 54.0, 57.8) in 2017-2020 (**Figure 3**). For US adults with hypertension in 2017-2020, adults aged 75+ had a higher estimated percentage using one or more antihypertensive medication class versus other age groups (**Figure S8**), women a higher estimated percentage using one or more antihypertensive medication class versus men (**Figure S9**), and non-Hispanic white adults a higher estimated percentage using one or more classes of antihypertensive medication versus other race/ethnicity groups (**Figure S10**).

**Resistant hypertension**

Among US adults with hypertension using three or more classes of antihypertensive medication, the estimated prevalence of resistant hypertension was 70.6 (95% CI 62.8, 78.3) in 1999-2000, 62.7 (95% CI 58.6, 66.7) in 2009-2010, and 66.0 (95% CI 61.9, 70.1) in 2017-2020 (**Figure 4**). For US adults with hypertension using three or more classes of antihypertensive medication in 2017-2020, adults aged 18 to 44 years had a higher estimated prevalence of resistant hypertension versus other age groups (**Figure S11**), men a higher estimated prevalence versus women (**Figure S12**), and non-Hispanic Black adults a higher estimated prevalence versus other race/ethnicity groups (**Figure S13**).

```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "portrait"),
    type = "continuous"
  )
)
```


__Table 1__ Characteristics of participants included in the blood pressure and hypertension cohort of the online platform.

```{r, cache=TRUE}


tbl_summary_data <- as_tibble(nhanes_bp) %>% 
 filter(svy_subpop_htn == 1) %>% 
 mutate(nobs = 1) %>% 
 select(
  svy_psu,
  svy_strata,
  svy_weight_mec,
  svy_year,
  nobs,
  starts_with('demo'),
  starts_with('bp'), - bp_cat_meds_excluded,
  starts_with('htn'),
  starts_with('cc')
 ) 

for(i in names(tbl_summary_data)){
 attr(tbl_summary_data[[i]], 'label') <-
  nhanes_key$variables[[i]]$label
}

tbl_summary_design <- tbl_summary_data %>% 
 svydesign(ids = ~ svy_psu,
           strata = ~ svy_strata,
           weights = ~ svy_weight_mec,
           data = .,
           nest = TRUE)

tbl_gtsummary <- tbl_summary_design %>% 
 tbl_svysummary(
  by = svy_year,
  include = c(nobs, 
              starts_with("demo"),
              starts_with('bp'),
              starts_with('htn'),
              starts_with('cc')),
  missing = 'no',
  label = list(nobs ~ "No. of Adults"),
  statistic = list(
   all_categorical() ~ "{p}",
   all_continuous() ~ "{mean} ({sd})",
   nobs ~ "{N_unweighted}"
  )
 ) %>%
 modify_header(all_stat_cols() ~ "**{level}**") %>%
 add_overall(last = FALSE, col_label = "**Overall**") %>% 
 modify_footnote(all_stat_cols() ~ NA)

as_flex_table(tbl_gtsummary) %>% 
 theme_box() %>% 
 width(width = 0.8) %>% 
 width(j = 1, width = 2) %>% 
 align(align = 'center') %>% 
 align(j = 1, align = 'left')


```

```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "landscape"),
    page_margins = page_mar(bottom = 1/12, top = 1/12, 
                            right = 1/8, left = 1/8),
    type = "continuous"
  )
)
```

__Figure 1__ Prevalence of hypertension by calendar year.

```{r}

subset_variables <- list("demo_pregnant")
subset_values <- list(c("No", "Missing"))

nhanes_visualize(outcome = 'htn_accaha', 
                 subset_variables = subset_variables,
                 subset_values = subset_values,
                 years = 'all')[[1]] %>% 
 layout(font = list(size = 40))

```

\newpage

__Figure 2__ Antihypertensive medication use by calendar year among adults with hypertension.

```{r}

nhanes_visualize(
 outcome = 'bp_med_use', 
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'all'
)[[1]] %>% 
 layout(font = list(size = 40))

```

\newpage

__Figure 3__ Number of antihypertensive medication classes by calendar period among adults with hypertension.

```{r}

nhanes_visualize(
 outcome = 'bp_med_n_class', 
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'all'
)[[1]] %>% 
 layout(font = list(size = 40))

```

\newpage

__Figure 4__ Prevalence of resistant hypertension among adults with hypertension taking three or more classes of antihypertensive medication.

```{r}

nhanes_visualize(
 outcome = 'htn_resistant_accaha',
 subset_variables = c(subset_variables, 
                      'htn_accaha', 
                      'bp_med_n_class'),
 subset_values = c(subset_values, 
                   'Yes', 
                   list(c('Three', 'Four or more'))),
 years = 'all'
)[[1]] %>%
 layout(font = list(size = 40))

```

\newpage

__Table S1__ Variable definitions for the online platform.

```{r}

library(tidyverse)
library(flextable)

nhanes_key$data %>% 
 as_tibble() %>%
 select(class, label, source, description) %>% 
 as_grouped_data(groups = 'class') %>% 
 as_flextable(hide_grouplabel = TRUE) %>% 
 theme_box() %>% 
 width(width = 1) %>% 
 width(j = 1, width = 2.5)
 

```


\newpage

__Figure S1__: Participants included in the current analysis.

\newpage

__Figure S2__ Prevalence of hypertension by age group in 2017-2020.

```{r}

nhanes_visualize(outcome = 'htn_accaha', 
                 exposure = 'demo_age_cat',
                 subset_variables = subset_variables,
                 subset_values = subset_values,
                 years = 'most_recent')[[1]] %>% 
 layout(font = list(size = 40))

```

\newpage

__Figure S3__ Prevalence of hypertension by sex in 2017-2020.

```{r}

nhanes_visualize(outcome = 'htn_accaha', 
                 exposure = 'demo_gender',
                 subset_variables = subset_variables,
                 subset_values = subset_values,
                 years = 'most_recent')[[1]] %>% 
 layout(font = list(size = 40))

```

\newpage

__Figure S4__ Prevalence of hypertension by race/ethnicity in 2017-2020.

```{r}

nhanes_visualize(outcome = 'htn_accaha', 
                 exposure = 'demo_race',
                 subset_variables = subset_variables,
                 subset_values = subset_values,
                 years = 'most_recent')[[1]] %>% 
 layout(font = list(size = 40))

```

\newpage

__Figure S5__ Antihypertensive medication use by age category in 2017-2020 among adults with hypertension.

```{r}

nhanes_visualize(
 outcome = 'bp_med_use', 
 exposure = 'demo_age_cat',
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'most_recent'
)[[1]] %>% 
 layout(font = list(size = 40))

```



\newpage

__Figure S6__ Antihypertensive medication use by sex in 2017-2020 among adults with hypertension.

```{r}

nhanes_visualize(
 outcome = 'bp_med_use', 
 exposure = 'demo_gender',
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'most_recent'
)[[1]] %>% 
 layout(font = list(size = 40))

```



\newpage

__Figure S7__ Antihypertensive medication use by race/ethnicity in 2017-2020 among adults with hypertension.

```{r}

nhanes_visualize(
 outcome = 'bp_med_use', 
 exposure = 'demo_race',
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'most_recent'
)[[1]] %>% 
 layout(font = list(size = 40))

```


\newpage

__Figure S8__ Number of antihypertensive medication classes by age category in 2017-2020 among adults with hypertension.

```{r, fig.height = 5}

margin <- list(l = 50, r = 50, b = 50, t = 300)

nhanes_visualize(
 outcome = 'bp_med_n_class', 
 exposure = 'demo_age_cat',
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'most_recent',
 pool = TRUE
)[[1]] %>% 
 layout(font = list(size = 40), margin = margin)

```

\newpage

__Figure S9__ Number of antihypertensive medication classes by sex in 2017-2020 among adults with hypertension.

```{r, fig.height = 5}

nhanes_visualize(
 outcome = 'bp_med_n_class', 
 exposure = 'demo_gender',
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'most_recent',
 pool = TRUE
)[[1]] %>% 
 layout(font = list(size = 40), margin = margin)

```

\newpage

__Figure S10__ Number of antihypertensive medication classes by race/ethnicity in 2017-2020 among adults with hypertension.

```{r, fig.height = 5}

nhanes_visualize(
 outcome = 'bp_med_n_class', 
 exposure = 'demo_race',
 subset_variables = c(subset_variables, 'htn_accaha'),
 subset_values = c(subset_values, 'Yes'),
 years = 'most_recent',
 pool = TRUE
)[[1]] %>% 
 layout(font = list(size = 40), margin = margin)

```

\newpage

__Figure S11__ Prevalence of resistant hypertension by age category in 2017-2020 among adults with hypertension taking three or more classes of antihypertensive medication.

```{r}

nhanes_visualize(
 outcome = 'htn_resistant_accaha',
 exposure = 'demo_age_cat',
 subset_variables = c(subset_variables, 
                      'htn_accaha', 
                      'bp_med_n_class'),
 subset_values = c(subset_values, 
                   'Yes', 
                   list(c('Three', 'Four or more'))),
 years = 'most_recent'
)[[1]] %>%
 layout(font = list(size = 40))


```

\newpage

__Figure S12__ Prevalence of resistant hypertension by sex in 2017-2020 among adults with hypertension taking three or more classes of antihypertensive medication.

```{r}

nhanes_visualize(
 outcome = 'htn_resistant_accaha',
 exposure = 'demo_gender',
 subset_variables = c(subset_variables, 
                      'htn_accaha', 
                      'bp_med_n_class'),
 subset_values = c(subset_values, 
                   'Yes', 
                   list(c('Three', 'Four or more'))),
 years = 'most_recent'
)[[1]] %>%
 layout(font = list(size = 40))

```

\newpage

__Figure S13__ Prevalence of resistant hypertension by race/ethnicity in 2017-2020 among adults with hypertension taking three or more classes of antihypertensive medication.

```{r}

nhanes_visualize(
 outcome = 'htn_resistant_accaha',
 exposure = 'demo_race',
 subset_variables = c(subset_variables, 
                      'htn_accaha', 
                      'bp_med_n_class'),
 subset_values = c(subset_values, 
                   'Yes', 
                   list(c('Three', 'Four or more'))),
 years = 'most_recent'
)[[1]] %>%
 layout(font = list(size = 40))

```
