---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cardioStatsUSA <img src="man/figures/logo.png" align="right" height="139" />


<!-- badges: start -->
[![Codecov test coverage](https://codecov.io/gh/jhs-hwg/nhanes-shiny-bp/branch/main/graph/badge.svg)](https://app.codecov.io/gh/jhs-hwg/nhanes-shiny-bp?branch=main)
[![R-CMD-check](https://github.com/jhs-hwg/nhanes-shiny-bp/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/jhs-hwg/nhanes-shiny-bp/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

Our goal is to provide a platform for exploration of the National Health and Nutrition Examination Survey (NHANES) data. 

## Installation

You can install the development version of cardioStatsUSA from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("jhs-hwg/cardioStatsUSA")
```

## Example

The shiny application is hosted on a public server, but you can also run it locally:

```{r, eval=FALSE}

library(cardioStatsUSA)
app_run()

```

## Why we made this

## Methods

### Weights

if counts are requested, we re-calibrate weights.

### Validation of results from the shiny application

We have replicated results from prior NHANES publications to verify that routines used to conduct analyses in this app are valid. Based on these tests, we have identified some cases where our app does not exactly match previously published articles, and we note those cases here.

TO BE WRITTEN: notes on tests showing exact match with [Muntner et al](https://jamanetwork.com/journals/jama/fullarticle/2770254)

TO BE WRITTEN: notes on discrepancies with results in [Carey et al.](https://www.ahajournals.org/doi/10.1161/HYPERTENSIONAHA.118.12191) 

## Results

### Participant characteristics

```{r}

suppressPackageStartupMessages({
 library(cardioStatsUSA)
 library(magrittr)
 library(gtsummary)
 library(tidyverse)
 library(survey)
 library(gt)
})


tbl_summary_data <- as_tibble(nhanes_bp) %>% 
 filter(svy_subpop_htn == 1) %>% 
 mutate(nobs = 1) %>% 
 select(
  svy_psu,
  svy_strata,
  svy_weight_mec,
  svy_year,
  nobs,
  starts_with('demo'),
  starts_with('bp'), - bp_cat_meds_excluded,
  starts_with('htn'),
  starts_with('cc')
 ) 

for(i in names(tbl_summary_data)){
 attr(tbl_summary_data[[i]], 'label') <- nhanes_key$variables[[i]]$label
}

tbl_summary_design <- tbl_summary_data %>% 
 svydesign(ids = ~ svy_psu,
           strata = ~ svy_strata,
           weights = ~ svy_weight_mec,
           data = .,
           nest = TRUE)

tbl_summary_design %>% 
 tbl_svysummary(
  by = svy_year,
  include = c(nobs, 
              starts_with("demo"),
              starts_with('bp'), 
              starts_with('htn'),
              starts_with('cc')),
  missing = 'no',
  label = list(nobs ~ "No. of Adults"),
  statistic = list(
   all_categorical() ~ "{p}",
   all_continuous() ~ "{mean} ({sd})",
   nobs ~ "{N_unweighted}"
  )
 ) %>%
 modify_header(all_stat_cols() ~ "**{level}**") %>%
 modify_footnote(all_stat_cols() ~ NA) %>%
 as_gt() %>%
 tab_source_note("Table values are mean (standard deviation) or percent.")

```


